<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.education.admin.modules.finance.mapper.FinanceOrderMapper">

    <!-- 真实订单分页查询：仅返回页面需要的字段；金额用 actual_amount；状态用 order_status -->
    <select id="findOrders" resultType="map">
        SELECT
            oi.id,
            oi.order_no       AS orderNo,
            s.student_name    AS studentName,
            t.teacher_name    AS teacherName,
            oi.course_name    AS courseName,
            oi.actual_amount  AS actualAmount,
            oi.order_status   AS orderStatus,
            oi.payment_status AS paymentStatus,
            DATE_FORMAT(oi.create_time, '%Y-%m-%d %H:%i:%s') AS createTime
        FROM order_info oi
        LEFT JOIN student_info s ON s.id = oi.student_id
        LEFT JOIN teacher_info t ON t.id = oi.teacher_id
        <where>
            <if test="orderNo != null and orderNo != ''">
                AND oi.order_no LIKE CONCAT('%', #{orderNo}, '%')
            </if>
            <if test="studentName != null and studentName != ''">
                AND s.student_name LIKE CONCAT('%', #{studentName}, '%')
            </if>
            <if test="orderStatus != null">
                AND oi.order_status = #{orderStatus}
            </if>
        </where>
        ORDER BY oi.create_time DESC
    </select>

</mapper>


