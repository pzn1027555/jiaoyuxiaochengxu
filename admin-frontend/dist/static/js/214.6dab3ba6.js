"use strict";(self["webpackChunkadmin_frontend"]=self["webpackChunkadmin_frontend"]||[]).push([[214],{1429:function(t,e,r){r.d(e,{BM:function(){return l},KU:function(){return o},Kh:function(){return u},Pj:function(){return c},Rc:function(){return d},n7:function(){return n},qS:function(){return s},sG:function(){return i}});var a=r(6879);function n(t){return(0,a.A)({url:"/finance/orders/list",method:"post",data:t})}function o(t){return(0,a.A)({url:`/finance/orders/${t}`,method:"get"})}function l(){return(0,a.A)({url:"/finance/statistics",method:"get"})}function i(){return(0,a.A)({url:"/finance/statistics/orders",method:"get"})}function s(){return(0,a.A)({url:"/finance/statistics/payment-methods",method:"get"})}function u(){return(0,a.A)({url:"/finance/statistics/course-types",method:"get"})}function d(t=10){return(0,a.A)({url:"/finance/statistics/teacher-revenue-ranking",method:"get",params:{limit:t}})}function c(t=10){return(0,a.A)({url:"/finance/statistics/student-consumption-ranking",method:"get",params:{limit:t}})}},8214:function(t,e,r){r.r(e),r.d(e,{default:function(){return d}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"page-container"},[e("div",{staticClass:"content-box"},[e("h2",[t._v("订单管理")]),e("el-form",{staticClass:"search-form",attrs:{model:t.queryForm,inline:!0}},[e("el-form-item",{attrs:{label:"订单号"}},[e("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:"请输入订单号",clearable:""},model:{value:t.queryForm.orderNo,callback:function(e){t.$set(t.queryForm,"orderNo",e)},expression:"queryForm.orderNo"}})],1),e("el-form-item",{attrs:{label:"学生姓名"}},[e("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"请输入学生姓名",clearable:""},model:{value:t.queryForm.studentName,callback:function(e){t.$set(t.queryForm,"studentName",e)},expression:"queryForm.studentName"}})],1),e("el-form-item",{attrs:{label:"订单状态"}},[e("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择状态",clearable:""},model:{value:t.queryForm.orderStatus,callback:function(e){t.$set(t.queryForm,"orderStatus",e)},expression:"queryForm.orderStatus"}},[e("el-option",{attrs:{label:"待支付",value:1}}),e("el-option",{attrs:{label:"已支付",value:2}}),e("el-option",{attrs:{label:"已完成",value:3}}),e("el-option",{attrs:{label:"已取消",value:4}}),e("el-option",{attrs:{label:"已退款",value:5}})],1)],1),e("el-form-item",[e("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleSearch}},[t._v("搜索")]),e("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:t.handleReset}},[t._v("重置")])],1)],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.orderList,stripe:"",border:""}},[e("el-table-column",{attrs:{prop:"orderNo",label:"订单号",width:"180"},scopedSlots:t._u([{key:"default",fn:function(r){return[e("el-link",{attrs:{type:"primary"},on:{click:function(e){return t.viewOrderDetail(r.row)}}},[t._v(t._s(r.row.orderNo))])]}}])}),e("el-table-column",{attrs:{prop:"studentName",label:"学生",width:"100"}}),e("el-table-column",{attrs:{prop:"teacherName",label:"教师",width:"100"}}),e("el-table-column",{attrs:{prop:"courseName",label:"课程名称",width:"150","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{label:"金额信息",width:"150"},scopedSlots:t._u([{key:"default",fn:function(r){return[e("div",{staticStyle:{color:"#67C23A","font-weight":"bold"}},[t._v("实付：¥"+t._s(t.formatAmount(r.row.actualAmount)))])]}}])}),e("el-table-column",{attrs:{label:"订单状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(r){return[e("el-tag",{attrs:{type:t.getOrderStatusType(r.row.orderStatus)}},[t._v(" "+t._s(t.getOrderStatusText(r.row.orderStatus))+" ")])]}}])}),e("el-table-column",{attrs:{prop:"createTime",label:"创建时间",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.formatDateTime(e.row.createTime))+" ")]}}])})],1),e("div",{staticClass:"pagination-wrapper"},[e("el-pagination",{attrs:{"current-page":t.queryForm.pageNum,"page-sizes":[10,20,50,100],"page-size":t.queryForm.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1),e("el-dialog",{attrs:{title:"订单详情",visible:t.detailDialogVisible,width:"800px"},on:{"update:visible":function(e){t.detailDialogVisible=e}}},[t.orderDetail?e("div",[e("p",[t._v("订单号："+t._s(t.orderDetail.orderNo))]),e("p",[t._v("学生："+t._s(t.orderDetail.studentName))]),e("p",[t._v("教师："+t._s(t.orderDetail.teacherName))]),e("p",[t._v("课程："+t._s(t.orderDetail.courseName))]),e("p",[t._v("金额：¥"+t._s(t.formatAmount(t.orderDetail.actualAmount)))]),e("p",[t._v(" 状态： "),e("el-tag",{attrs:{type:t.getOrderStatusType(t.orderDetail.orderStatus)}},[t._v(" "+t._s(t.getOrderStatusText(t.orderDetail.orderStatus))+" ")])],1)]):t._e()])],1)},n=[],o=r(1429),l={name:"OrderManagement",data(){return{loading:!1,orderList:[],total:0,statistics:{},queryForm:{orderNo:"",studentName:"",orderStatus:null,pageNum:1,pageSize:20},detailDialogVisible:!1,orderDetail:null}},created(){this.loadOrderList(),this.loadStatistics()},methods:{async loadOrderList(){this.loading=!0;try{const t=await(0,o.n7)(this.queryForm);200===t.code&&(this.orderList=(t.data.list||[]).map(t=>({...t,orderStatus:null!=t.orderStatus?t.orderStatus:null!=t.order_status?t.order_status:null!=t.status?t.status:null,paymentStatus:null!=t.paymentStatus?t.paymentStatus:null!=t.payment_status?t.payment_status:null,originalAmount:null!=t.originalAmount?t.originalAmount:null!=t.totalAmount?t.totalAmount:null!=t.total_amount?t.total_amount:t.original_amount,actualAmount:null!=t.actualAmount?t.actualAmount:null!=t.actual_amount?t.actual_amount:null,createTime:null!=t.createTime?t.createTime:null!=t.create_time?t.create_time:null,studentName:null!=t.studentName?t.studentName:t.student_name,teacherName:null!=t.teacherName?t.teacherName:t.teacher_name,courseName:null!=t.courseName?t.courseName:t.course_name})),this.total=t.data.total)}catch(t){this.$message.error("加载订单列表失败")}finally{this.loading=!1}},async loadStatistics(){try{const t=await(0,o.sG)();200===t.code&&(this.statistics=t.data)}catch(t){console.error("加载统计数据失败",t)}},handleSearch(){this.queryForm.pageNum=1,this.loadOrderList()},handleReset(){this.queryForm={orderNo:"",studentName:"",orderStatus:null,pageNum:1,pageSize:20},this.loadOrderList()},handleSizeChange(t){this.queryForm.pageSize=t,this.queryForm.pageNum=1,this.loadOrderList()},handleCurrentChange(t){this.queryForm.pageNum=t,this.loadOrderList()},async viewOrderDetail(t){try{const e=await(0,o.KU)(t.id);200===e.code&&(this.orderDetail=e.data,this.detailDialogVisible=!0)}catch(e){this.$message.error("获取订单详情失败")}},handleAction(t){this.$message.info("操作功能开发中")},formatAmount(t){return t?Number(t).toFixed(2):"0.00"},formatPercent(t){return t?Number(t).toFixed(2):"0.00"},formatDateTime(t){return t?new Date(t).toLocaleString():"-"},getOrderStatusType(t){const e={1:"warning",2:"info",3:"success",4:"",5:"danger"};return e[Number(t)]||""},getOrderStatusText(t){const e={1:"待支付",2:"已支付",3:"已完成",4:"已取消",5:"已退款"};return e[Number(t)]||"未知状态"}}},i=l,s=r(1656),u=(0,s.A)(i,a,n,!1,null,"54e59a84",null),d=u.exports}}]);