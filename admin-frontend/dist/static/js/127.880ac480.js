"use strict";(self["webpackChunkadmin_frontend"]=self["webpackChunkadmin_frontend"]||[]).push([[127],{8127:function(e,t,a){a.r(t),a.d(t,{default:function(){return d}});var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-container"},[t("div",{staticClass:"content-box"},[t("h2",[e._v("学生管理")]),t("div",{staticClass:"search-bar"},[t("el-form",{staticClass:"search-form",attrs:{inline:!0,model:e.searchForm}},[t("el-form-item",{attrs:{label:"学生姓名"}},[t("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入学生姓名",clearable:""},model:{value:e.searchForm.studentName,callback:function(t){e.$set(e.searchForm,"studentName",t)},expression:"searchForm.studentName"}})],1),t("el-form-item",{attrs:{label:"手机号"}},[t("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:"请输入手机号",clearable:""},model:{value:e.searchForm.phone,callback:function(t){e.$set(e.searchForm,"phone",t)},expression:"searchForm.phone"}})],1),t("el-form-item",{attrs:{label:"等级"}},[t("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.searchForm.studentLevel,callback:function(t){e.$set(e.searchForm,"studentLevel",t)},expression:"searchForm.studentLevel"}},[t("el-option",{attrs:{label:"青铜",value:"bronze"}}),t("el-option",{attrs:{label:"白银",value:"silver"}}),t("el-option",{attrs:{label:"黄金",value:"gold"}})],1)],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.searchForm.status,callback:function(t){e.$set(e.searchForm,"status",t)},expression:"searchForm.status"}},[t("el-option",{attrs:{label:"在读",value:1}}),t("el-option",{attrs:{label:"暂停",value:2}}),t("el-option",{attrs:{label:"毕业",value:3}}),t("el-option",{attrs:{label:"禁用",value:0}})],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),t("el-button",{on:{click:e.resetSearch}},[e._v("重置")])],1)],1)],1),t("div",{staticClass:"table-container"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"custom-table",staticStyle:{width:"100%"},attrs:{data:e.studentList,stripe:""}},[t("el-table-column",{attrs:{prop:"studentNo",label:"学号",width:"140"}}),t("el-table-column",{attrs:{prop:"studentName",label:"姓名",width:"120"}}),t("el-table-column",{attrs:{prop:"phone",label:"手机号",width:"140"}}),t("el-table-column",{attrs:{prop:"studentLevel",label:"等级",width:"140"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择等级",size:"mini"},on:{change:t=>e.updateLevel(a.row,t)},model:{value:a.row.studentLevel,callback:function(t){e.$set(a.row,"studentLevel",t)},expression:"scope.row.studentLevel"}},[t("el-option",{attrs:{label:"青铜",value:"bronze"}}),t("el-option",{attrs:{label:"白银",value:"silver"}}),t("el-option",{attrs:{label:"黄金",value:"gold"}})],1)]}}])}),t("el-table-column",{attrs:{prop:"remainingCourses",label:"剩余课时",width:"100"}}),t("el-table-column",{attrs:{prop:"totalAmount",label:"累计消费(¥)",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.formatAmount(t.row.totalAmount)))]}}])}),t("el-table-column",{attrs:{prop:"lastCourseTime",label:"最后上课时间",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.formatDate(t.row.lastCourseTime)))]}}])}),t("el-table-column",{attrs:{prop:"status",label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.statusText(t.row.status)))]}}])}),t("el-table-column",{attrs:{label:"地区","min-width":"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s([t.row.province,t.row.city,t.row.district].filter(Boolean).join(" / ")))]}}])}),t("el-table-column",{attrs:{label:"家长","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[0===(a.row.parents||[]).length?t("span",[e._v("-")]):t("span",e._l(a.row.parents,function(a){return t("el-tag",{key:a.id,staticStyle:{margin:"2px"},attrs:{size:"mini"}},[e._v(e._s(a.parentName)+"（"+e._s(a.phone||"-")+"）")])}),1)]}}])}),t("el-table-column",{attrs:{label:"操作",width:"200",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.sendRechargeReminder(a.row)}}},[e._v("续费提醒")]),t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.goComplaint(a.row)}}},[e._v("投诉处理")])]}}])})],1),t("div",{staticClass:"pagination-container"},[t("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)])])},s=[],n=a(6879);function r(e){return(0,n.A)({url:"/student/list",method:"get",params:e})}var o={name:"StudentList",data(){return{loading:!1,searchForm:{studentName:"",phone:"",studentLevel:"",status:null},studentList:[],currentPage:1,pageSize:10,total:0}},mounted(){this.fetch()},methods:{async fetch(){this.loading=!0;try{const e={...this.searchForm,pageNum:this.currentPage,pageSize:this.pageSize},t=await r(e),a=t.data||t;this.studentList=a.list||[],this.total=a.total||0}finally{this.loading=!1}},handleSearch(){this.currentPage=1,this.fetch()},resetSearch(){this.searchForm={studentName:"",phone:"",studentLevel:"",status:null},this.handleSearch()},handleSizeChange(e){this.pageSize=e,this.currentPage=1,this.fetch()},handleCurrentChange(e){this.currentPage=e,this.fetch()},levelText(e){const t={bronze:"青铜",silver:"白银",gold:"黄金"};return t[e]||"-"},statusText(e){const t={1:"在读",2:"暂停",3:"毕业",0:"禁用"};return t[e]||"-"},formatAmount(e){if(null==e)return"0.00";const t=Number(e);return isNaN(t)?"0.00":t.toFixed(2)},formatDate(e){if(!e)return"-";try{return new Date(e).toLocaleString("zh-CN")}catch(t){return"-"}},async updateLevel(e,t){try{await this.$confirm(`确认将 ${e.studentName} 等级调整为 ${this.levelText(t)} 吗？`,"提示"),await(0,n.A)({url:"/student/update-level",method:"post",data:{id:e.id,studentLevel:t}}),this.$message.success("已更新")}catch(a){}},async sendRechargeReminder(e){try{await this.$confirm("将向学生及其家长发送“余额不足，请及时充值”提醒","续费提醒",{type:"warning"});const t=await(0,n.A)({url:"/student/send-renewal-reminder",method:"post",data:{studentId:e.id}});!t||200!==t.code&&!0!==t.success?this.$message.warning(t&&t.message||"提醒发送状态未知"):this.$message.success("提醒已发送")}catch(t){}},goComplaint(e){if(!e.phone)return void this.$message.error("学生手机号缺失，无法跳转投诉处理");const t="/complaint/",a=(t.startsWith("http"),`${t}?phone=${encodeURIComponent(e.phone)}`);window.open(a,"_blank")}}},i=o,u=a(1656),c=(0,u.A)(i,l,s,!1,null,"497c83d6",null),d=c.exports}}]);