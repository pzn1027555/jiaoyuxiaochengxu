"use strict";(self["webpackChunkadmin_frontend"]=self["webpackChunkadmin_frontend"]||[]).push([[981],{1981:function(e,t,r){r.r(t),r.d(t,{default:function(){return c}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-container"},[t("div",{staticClass:"content-box"},[t("div",{staticClass:"toolbar"},[t("el-input",{staticClass:"mr8",attrs:{placeholder:"分类名称/编码",clearable:""},on:{clear:e.handleSearch},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.query.keyword,callback:function(t){e.$set(e.query,"keyword",t)},expression:"query.keyword"}}),t("el-select",{staticClass:"mr8",attrs:{placeholder:"层级",clearable:""},on:{change:e.handleSearch},model:{value:e.query.level,callback:function(t){e.$set(e.query,"level",t)},expression:"query.level"}},[t("el-option",{attrs:{label:"一级",value:1}}),t("el-option",{attrs:{label:"二级",value:2}})],1),t("el-select",{staticClass:"mr8",attrs:{placeholder:"状态",clearable:""},on:{change:e.handleSearch},model:{value:e.query.status,callback:function(t){e.$set(e.query,"status",t)},expression:"query.status"}},[t("el-option",{attrs:{label:"启用",value:1}}),t("el-option",{attrs:{label:"禁用",value:0}})],1),t("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),t("el-button",{staticClass:"ml8",attrs:{type:"success"},on:{click:e.handleCreate}},[e._v("新增分类")])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.pagedList,border:"",stripe:""}},[t("el-table-column",{attrs:{prop:"id",label:"ID",width:"80"}}),t("el-table-column",{attrs:{prop:"categoryName",label:"分类名称","min-width":"180"}}),t("el-table-column",{attrs:{prop:"categoryCode",label:"分类编码",width:"160"}}),t("el-table-column",{attrs:{label:"层级",width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.levelText(t.row.level)))]}}])}),t("el-table-column",{attrs:{label:"上级科目",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(2===t.row.level&&t.row.parentName||"-"))]}}])}),t("el-table-column",{attrs:{prop:"sortOrder",label:"排序",width:"90"}}),t("el-table-column",{attrs:{label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(1===t.row.status?"启用":"禁用"))]}}])}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间",width:"170"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.formatDate(t.row.createTime)))]}}])}),t("el-table-column",{attrs:{label:"操作",width:"200",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleEdit(r.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(r.row)}}},[e._v("删除")])]}}])})],1),t("div",{staticClass:"pager"},[t("el-pagination",{attrs:{background:"",layout:"prev, pager, next, sizes, total",total:e.total,"page-size":e.query.pageSize,"current-page":e.query.pageNum},on:{"update:currentPage":function(t){return e.$set(e.query,"pageNum",t)},"update:current-page":function(t){return e.$set(e.query,"pageNum",t)},"current-change":e.paginate,"size-change":e.handleSizeChange}})],1)],1),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"520px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"formRef",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"分类名称",prop:"categoryName"}},[t("el-input",{model:{value:e.form.categoryName,callback:function(t){e.$set(e.form,"categoryName",t)},expression:"form.categoryName"}})],1),t("el-form-item",{attrs:{label:"分类编码",prop:"categoryCode"}},[t("el-input",{model:{value:e.form.categoryCode,callback:function(t){e.$set(e.form,"categoryCode",t)},expression:"form.categoryCode"}})],1),t("el-form-item",{attrs:{label:"层级",prop:"level"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.level,callback:function(t){e.$set(e.form,"level",t)},expression:"form.level"}},[t("el-option",{attrs:{label:"一级",value:1}}),t("el-option",{attrs:{label:"二级",value:2}})],1)],1),2===e.form.level?t("el-form-item",{attrs:{label:"父分类"}},[t("el-select",{attrs:{placeholder:"选择父分类",filterable:"",clearable:""},model:{value:e.form.parentId,callback:function(t){e.$set(e.form,"parentId",t)},expression:"form.parentId"}},e._l(e.parentOptions,function(e){return t("el-option",{key:e.id,attrs:{label:e.categoryName,value:e.id}})}),1)],1):e._e(),t("el-form-item",{attrs:{label:"排序"}},[t("el-input-number",{attrs:{min:0,max:999},model:{value:e.form.sortOrder,callback:function(t){e.$set(e.form,"sortOrder",t)},expression:"form.sortOrder"}})],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-radio-group",{model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},[t("el-radio",{attrs:{label:1}},[e._v("启用")]),t("el-radio",{attrs:{label:0}},[e._v("禁用")])],1)],1),t("el-form-item",{attrs:{label:"描述"}},[t("el-input",{attrs:{type:"textarea",rows:3},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确定")])],1)],1)],1)},l=[],o=r(9550),s={name:"SubjectCategory",data(){return{loading:!1,list:[],pagedList:[],total:0,query:{pageNum:1,pageSize:10,keyword:"",level:null,status:null},dialogVisible:!1,dialogTitle:"新增分类",form:{id:null,categoryName:"",categoryCode:"",level:1,parentId:null,sortOrder:0,status:1,description:""},rules:{categoryName:[{required:!0,message:"请输入分类名称",trigger:"blur"}],categoryCode:[{required:!0,message:"请输入分类编码",trigger:"blur"}]},parentOptions:[]}},mounted(){this.loadData(),this.loadParents()},methods:{async loadData(){this.loading=!0;try{const t={categoryName:this.query.keyword,level:this.query.level,status:this.query.status},r=await o.MF.list(t);let a=r&&(r.data||r)||[];a=Array.isArray(a)?a:[];let l={};if((this.parentOptions||[]).length)l=this.parentOptions.reduce((e,t)=>(e[t.id]=t.categoryName,e),{});else try{const e=await o.MF.topLevel(),t=e&&(e.data||e)||[];l=Array.isArray(t)?t.reduce((e,t)=>(e[t.id]=t.categoryName,e),{}):{}}catch(e){l={}}a=a.map(e=>({...e,parentName:2===e.level&&l[e.parentId]||""}));const s=new Intl.Collator("zh-Hans-CN",{sensitivity:"base",numeric:!0});a.sort((e,t)=>{const r=2===e.level?e.parentName||"":e.categoryName||"",a=2===t.level?t.parentName||"":t.categoryName||"",l=s.compare(r,a);if(0!==l)return l;const o=e.sortOrder??0,n=t.sortOrder??0;return o!==n?o-n:s.compare(e.categoryName||"",t.categoryName||"")}),this.list=a,this.total=this.list.length,this.paginate(this.query.pageNum)}finally{this.loading=!1}},async loadParents(){try{const e=await o.MF.topLevel(),t=e&&(e.data||e)||[];this.parentOptions=Array.isArray(t)?t:[]}catch(e){this.parentOptions=[]}},paginate(e){this.query.pageNum=e;const t=(this.query.pageNum-1)*this.query.pageSize;this.pagedList=this.list.slice(t,t+this.query.pageSize)},handleSizeChange(e){this.query.pageSize=e,this.paginate(1)},handleSearch(){this.query.pageNum=1,this.loadData()},handleCreate(){this.dialogTitle="新增分类",this.form={id:null,categoryName:"",categoryCode:"",level:1,parentId:null,sortOrder:0,status:1,description:""},this.dialogVisible=!0},handleEdit(e){this.dialogTitle="编辑分类",this.form={id:e.id,categoryName:e.categoryName,categoryCode:e.categoryCode,level:e.level,parentId:e.parentId,sortOrder:e.sortOrder,status:e.status,description:e.description},this.dialogVisible=!0},async handleDelete(e){await this.$confirm(`确定删除分类“${e.categoryName}”吗？`,"提示",{type:"warning"});const t=await o.MF.delete(e.id);!t||200!==t.code&&!0!==t.success||(this.$message.success("删除成功"),this.loadData())},async submit(){this.$refs.formRef.validate(async e=>{if(!e)return;const t={...this.form};if(2===t.level&&!t.parentId)return void this.$message.error("请选择父分类");2!==t.level&&(t.parentId=null);const r=t.id?await o.MF.update(t.id,t):await o.MF.create(t);!r||200!==r.code&&!0!==r.success||(this.$message.success(t.id?"更新成功":"创建成功"),this.dialogVisible=!1,this.loadData())})},levelText(e){return 1===e?"一级":2===e?"二级":"-"},formatDate(e){if(!e)return"-";try{return new Date(e).toLocaleString("zh-CN")}catch(t){return"-"}}}},n=s,i=r(1656),u=(0,i.A)(n,a,l,!1,null,"72957b78",null),c=u.exports},9550:function(e,t,r){r.d(t,{E8:function(){return u},MF:function(){return d},S9:function(){return l},Wd:function(){return i},_Y:function(){return s},jX:function(){return o},kY:function(){return c},s_:function(){return n}});var a=r(6879);function l(){return(0,a.A)({url:"/system/teacher-level/list",method:"get"})}function o(e){return(0,a.A)({url:"/system/teacher-level",method:"post",data:e})}function s(e,t){return(0,a.A)({url:`/system/teacher-level/${e}`,method:"put",data:t})}function n(e){return(0,a.A)({url:`/system/teacher-level/${e}`,method:"delete"})}const i={list(){return(0,a.A)({url:"/system/learning-system/list",method:"get"})},create(e){return(0,a.A)({url:"/system/learning-system",method:"post",data:e})},update(e,t){return(0,a.A)({url:`/system/learning-system/${e}`,method:"put",data:t})},remove(e){return(0,a.A)({url:`/system/learning-system/${e}`,method:"delete"})}},u={current(){return(0,a.A)({url:"/system/lesson-price/current",method:"get"})},save(e){return(0,a.A)({url:"/system/lesson-price/save",method:"post",data:e})}},c={list(e){return(0,a.A)({url:"/system/course-banner/list",method:"get",params:e})},create(e){return(0,a.A)({url:"/system/course-banner",method:"post",data:e})},update(e,t){return(0,a.A)({url:`/system/course-banner/${e}`,method:"put",data:t})},remove(e){return(0,a.A)({url:`/system/course-banner/${e}`,method:"delete"})}},d={list(e){return(0,a.A)({url:"/course-category/list",method:"get",params:e})},tree(){return(0,a.A)({url:"/course-category/tree",method:"get"})},topLevel(){return(0,a.A)({url:"/course-category/top-level",method:"get"})},detail(e){return(0,a.A)({url:`/course-category/${e}`,method:"get"})},create(e){return(0,a.A)({url:"/course-category",method:"post",data:e})},update(e,t){return(0,a.A)({url:`/course-category/${e}`,method:"put",data:t})},updateStatus(e,t){return(0,a.A)({url:`/course-category/${e}/status`,method:"post",params:{status:t}})},updateSort(e,t){return(0,a.A)({url:`/course-category/${e}/sort`,method:"post",params:{sortOrder:t}})},move(e,t){return(0,a.A)({url:`/course-category/${e}/move`,method:"post",params:{newParentId:t}})},delete(e){return(0,a.A)({url:`/course-category/${e}`,method:"delete"})},batchDelete(e){return(0,a.A)({url:"/course-category/batch",method:"delete",data:e})},checkCode(e,t){return(0,a.A)({url:"/course-category/check-code",method:"get",params:{categoryCode:e,excludeId:t}})},checkName(e,t,r){return(0,a.A)({url:"/course-category/check-name",method:"get",params:{categoryName:e,parentId:t,excludeId:r}})}}}}]);