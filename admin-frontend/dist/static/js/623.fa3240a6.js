"use strict";(self["webpackChunkadmin_frontend"]=self["webpackChunkadmin_frontend"]||[]).push([[623],{3623:function(t,e,s){s.r(e),s.d(e,{default:function(){return u}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"page-container"},[e("div",{staticClass:"content-box"},[e("h2",[t._v("班主任管理")]),e("div",{staticClass:"toolbar"},[e("el-input",{staticStyle:{width:"220px","margin-right":"8px"},attrs:{placeholder:"按姓名搜索",clearable:"",size:"mini"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSearch.apply(null,arguments)}},model:{value:t.query.name,callback:function(e){t.$set(t.query,"name",e)},expression:"query.name"}}),e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.onSearch}},[t._v("搜索")]),e("el-button",{attrs:{size:"mini"},on:{click:t.onReset}},[t._v("重置")]),e("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.openDialog()}}},[t._v("新增")])],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.filteredList,border:"",stripe:""}},[e("el-table-column",{attrs:{prop:"name",label:"姓名",width:"160"}}),e("el-table-column",{attrs:{prop:"phone",label:"电话",width:"160"}}),e("el-table-column",{attrs:{label:"二维码",width:"140"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-image",{staticStyle:{width:"80px",height:"80px","border-radius":"6px"},attrs:{src:t.abs(s.row.wechatQrUrl),"preview-src-list":[t.abs(s.row.wechatQrUrl)]}})]}}])}),e("el-table-column",{attrs:{label:"状态",width:"180"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-tag",{staticStyle:{"margin-right":"10px"},attrs:{type:1===s.row.status?"success":"info"}},[t._v(t._s(1===s.row.status?"启用":"停用"))]),e("el-switch",{attrs:{value:s.row.status,"active-value":1,"inactive-value":0},on:{change:e=>t.onToggleStatus(s.row,e)}})]}}])}),e("el-table-column",{attrs:{prop:"remark",label:"备注"}}),e("el-table-column",{attrs:{label:"操作",width:"200",align:"center"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.openDialog(s.row)}}},[t._v("编辑")]),e("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.onDelete(s.row)}}},[t._v("删除")])]}}])})],1),e("el-dialog",{attrs:{title:t.dialogTitle,visible:t.dialogVisible,width:"520px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-form",{ref:"formRef",attrs:{model:t.form,rules:t.rules,"label-width":"90px"}},[e("el-form-item",{attrs:{label:"姓名",prop:"name"}},[e("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),e("el-form-item",{attrs:{label:"电话"}},[e("el-input",{model:{value:t.form.phone,callback:function(e){t.$set(t.form,"phone",e)},expression:"form.phone"}})],1),e("el-form-item",{attrs:{label:"二维码",prop:"wechatQrUrl"}},[e("el-upload",{attrs:{"http-request":t.uploadQr,"show-file-list":!1,action:t.dummyAction,accept:"image/*"}},[e("el-button",[t._v("上传二维码")])],1),t.form.wechatQrUrl?e("div",{staticClass:"qr-preview"},[e("img",{attrs:{src:t.abs(t.form.wechatQrUrl)}})]):t._e()],1),e("el-form-item",{attrs:{label:"备注"}},[e("el-input",{attrs:{type:"textarea",rows:2},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("保存")])],1)],1)],1)])},i=[],r=s(4335),l={name:"HeadTeacher",data(){return{loading:!1,list:[],query:{name:""},dialogVisible:!1,dialogTitle:"新增班主任",form:{id:null,name:"",phone:"",wechatQrUrl:"",remark:"",status:1},rules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"}],wechatQrUrl:[{required:!0,message:"请上传二维码",trigger:"change"}]},dummyAction:"#"}},computed:{filteredList(){const t=(this.query.name||"").trim();return t?this.list.filter(e=>(e.name||"").includes(t)):this.list}},mounted(){this.loadList()},methods:{apiBase(){return"/api"},abs(t){if(!t)return"";if(/^https?:\/\//i.test(t))return t;const e="https://www.xwsedumatch.cn";return e?e+t:"/api"+(t.startsWith("/")?t:"/"+t)},async loadList(){this.loading=!0;try{const{data:t}=await r.A.get(this.apiBase()+"/admin/head-teacher/list");t&&(t.success||200===t.code)&&(this.list=t.data||[])}finally{this.loading=!1}},onSearch(){},onReset(){this.query.name=""},openDialog(t){t?(this.dialogTitle="编辑班主任",this.form={id:t.id,name:t.name,phone:t.phone,wechatQrUrl:t.wechatQrUrl,remark:t.remark,status:t.status}):(this.dialogTitle="新增班主任",this.form={id:null,name:"",phone:"",wechatQrUrl:"",remark:"",status:1}),this.dialogVisible=!0},async uploadQr(t){const e=new FormData;e.append("file",t.file);const{data:s}=await r.A.post(this.apiBase()+"/mini/upload/file",e,{headers:{"Content-Type":"multipart/form-data"}});if(s&&(s.success||200===s.code)){const t=s.data||{};this.form.wechatQrUrl=t.url,this.$message.success("上传成功")}else this.$message.error(s?.message||"上传失败")},async submit(){this.$refs.formRef.validate(async t=>{if(!t)return;const{data:e}=await r.A.post(this.apiBase()+"/admin/head-teacher/save",this.form);if(e&&(e.success||200===e.code))if(this.$message.success("保存成功"),this.dialogVisible=!1,this.form.id){const t=this.list.findIndex(t=>t.id===this.form.id);t>-1&&this.$set(this.list,t,{...this.list[t],...this.form})}else await this.loadList();else this.$message.error(e?.message||"保存失败")})},async onToggleStatus(t,e){const{data:s}=await r.A.post(this.apiBase()+`/admin/head-teacher/status?id=${t.id}&status=${e}`);if(s&&(s.success||200===s.code))if(this.$message.success(1===e?"已启用":"已停用"),1===e)this.list=this.list.map(e=>({...e,status:e.id===t.id?1:0}));else{const e=this.list.findIndex(e=>e.id===t.id);e>-1&&this.$set(this.list,e,{...this.list[e],status:0})}else this.$message.error(s?.message||"状态更新失败")},async onDelete(t){try{await this.$confirm("确认删除该班主任？","提示",{type:"warning"});const{data:e}=await r.A.post(this.apiBase()+`/admin/head-teacher/delete?id=${t.id}`);e&&(e.success||200===e.code)?(this.$message.success("删除成功"),this.list=this.list.filter(e=>e.id!==t.id)):this.$message.error(e?.message||"删除失败")}catch(e){"cancel"!==e&&this.$message.error("已取消或删除失败")}}}},n=l,o=s(1656),c=(0,o.A)(n,a,i,!1,null,"87f51790",null),u=c.exports}}]);