"use strict";(self["webpackChunkadmin_frontend"]=self["webpackChunkadmin_frontend"]||[]).push([[154],{4381:function(e,t,r){r.d(t,{$A:function(){return o},N2:function(){return m},Pf:function(){return n},RO:function(){return c},Sp:function(){return i},ZF:function(){return s},cg:function(){return l},mH:function(){return u},nJ:function(){return d},qg:function(){return f}});var a=r(6879);function o(e){return(0,a.A)({url:"/teacher/list",method:"get",params:e})}function s(){return(0,a.A)({url:"/teacher/risk-teachers",method:"get"})}function l(e){return(0,a.A)({url:"/mooc/applications",method:"get",params:e})}function n(){return(0,a.A)({url:"/mooc/groups",method:"get"})}function i(e,t){return(0,a.A)({url:`/teacher/${e}`,method:"put",data:t})}function c(e){return(0,a.A)({url:`/teacher/${e}/send-contract`,method:"post"})}function u(e){return(0,a.A)({url:`/teacher/${e}/check`,method:"post"})}function m(e){return(0,a.A)({url:`/teacher/${e}/toggle-hidden`,method:"post"})}function d(e){return(0,a.A)({url:`/teacher/${e}/toggle-recommend`,method:"post"})}function f(e){return(0,a.A)({url:`/teacher/${e}`,method:"delete"})}},5042:function(e,t,r){r.d(t,{q:function(){return o},y:function(){return s}});var a=r(6879);function o(e){return(0,a.A)({url:"/schedule/list",method:"get",params:e})}function s(e){return(0,a.A)({url:"/admin/schedule/big-class/plan",method:"post",data:e})}},9154:function(e,t,r){r.r(t),r.d(t,{default:function(){return f}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-container"},[t("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("班课发布")])]),t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"110px","label-position":"left"}},[t("el-form-item",{attrs:{label:"授课教师",prop:"teacherId"}},[t("el-select",{staticStyle:{width:"360px"},attrs:{filterable:"",placeholder:"请选择教师"},on:{"visible-change":e.onTeacherDropdown},model:{value:e.form.teacherId,callback:function(t){e.$set(e.form,"teacherId",t)},expression:"form.teacherId"}},e._l(e.teacherOptions,function(e){return t("el-option",{key:e.id,attrs:{label:e.teacherName+"（"+(e.phone||"-")+"）",value:e.id}})}),1)],1),t("el-form-item",{attrs:{label:"科目",prop:"subjectId"}},[t("el-cascader",{staticStyle:{width:"360px"},attrs:{options:e.subjectTree,props:{value:"id",label:"categoryName",children:"children",checkStrictly:!0},clearable:"",placeholder:"请选择科目（最多二级）"},on:{change:e.onSubjectChange},model:{value:e.form.subjectPath,callback:function(t){e.$set(e.form,"subjectPath",t)},expression:"form.subjectPath"}})],1),t("el-form-item",{attrs:{label:"课程名称",prop:"title"}},[t("el-input",{staticStyle:{width:"360px"},attrs:{maxlength:"50","show-word-limit":"",placeholder:"请输入课程名称"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),t("el-form-item",{attrs:{label:"课时",prop:"totalLessons"}},[t("el-input-number",{attrs:{min:1,max:200},model:{value:e.form.totalLessons,callback:function(t){e.$set(e.form,"totalLessons",t)},expression:"form.totalLessons"}})],1),t("el-form-item",{attrs:{label:"开始日期",prop:"startDate"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd"},model:{value:e.form.startDate,callback:function(t){e.$set(e.form,"startDate",t)},expression:"form.startDate"}})],1),t("el-form-item",{attrs:{label:"上课时间",prop:"startTime"}},[t("el-time-picker",{attrs:{placeholder:"选择时间","value-format":"HH:mm",format:"HH:mm"},model:{value:e.form.startTime,callback:function(t){e.$set(e.form,"startTime",t)},expression:"form.startTime"}})],1),t("el-form-item",{attrs:{label:"单节时长(分钟)",prop:"durationMinutes"}},[t("el-input-number",{attrs:{min:30,max:300},model:{value:e.form.durationMinutes,callback:function(t){e.$set(e.form,"durationMinutes",t)},expression:"form.durationMinutes"}})],1),t("el-form-item",{attrs:{label:"重复",prop:"repeatType"}},[t("el-radio-group",{model:{value:e.form.repeatType,callback:function(t){e.$set(e.form,"repeatType",t)},expression:"form.repeatType"}},[t("el-radio-button",{attrs:{label:"daily"}},[e._v("每天")]),t("el-radio-button",{attrs:{label:"every3days"}},[e._v("每三天")]),t("el-radio-button",{attrs:{label:"every5days"}},[e._v("每五天")]),t("el-radio-button",{attrs:{label:"weekly"}},[e._v("每周")]),t("el-radio-button",{attrs:{label:"monthly"}},[e._v("每月")])],1)],1),t("el-form-item",{attrs:{label:"授课方式",prop:"teachMode"}},[t("el-radio-group",{model:{value:e.form.teachMode,callback:function(t){e.$set(e.form,"teachMode",t)},expression:"form.teachMode"}},[t("el-radio-button",{attrs:{label:"offline"}},[e._v("线下")]),t("el-radio-button",{attrs:{label:"online"}},[e._v("线上")])],1)],1),t("el-form-item",{attrs:{label:"封面图"}},[t("el-upload",{staticClass:"upload-demo",attrs:{action:"#","http-request":e.uploadCover,"show-file-list":!1,accept:"image/*"}},[t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("上传封面")])],1),e.form.coverUrl?t("div",{staticClass:"cover-preview"},[t("img",{attrs:{src:e.normalizeUrl(e.form.coverUrl),alt:"cover"}})]):e._e()],1),t("el-form-item",{attrs:{label:"课程标签"}},[t("el-select",{staticStyle:{width:"480px"},attrs:{multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"输入后回车新增"},model:{value:e.form.tags,callback:function(t){e.$set(e.form,"tags",t)},expression:"form.tags"}})],1),t("el-form-item",{attrs:{label:"课程介绍"}},[t("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入课程介绍"},model:{value:e.form.intro,callback:function(t){e.$set(e.form,"intro",t)},expression:"form.intro"}})],1),"offline"===e.form.teachMode?t("el-form-item",{attrs:{label:"上课地址"}},[t("el-input",{staticStyle:{width:"480px"},attrs:{placeholder:"地址（可选）"},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}}),t("div",{staticStyle:{"margin-top":"8px",display:"flex",gap:"8px","align-items":"center"}},[t("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"省"},model:{value:e.form.province,callback:function(t){e.$set(e.form,"province",t)},expression:"form.province"}}),t("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"市"},model:{value:e.form.city,callback:function(t){e.$set(e.form,"city",t)},expression:"form.city"}}),t("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"区/县"},model:{value:e.form.district,callback:function(t){e.$set(e.form,"district",t)},expression:"form.district"}})],1),t("div",{staticStyle:{"margin-top":"8px",display:"flex",gap:"8px","align-items":"center"}},[t("el-input",{staticStyle:{width:"360px"},attrs:{placeholder:"详细地址"},model:{value:e.form.detailAddress,callback:function(t){e.$set(e.form,"detailAddress",t)},expression:"form.detailAddress"}}),t("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"联系电话（必填）"},model:{value:e.form.contactPhone,callback:function(t){e.$set(e.form,"contactPhone",t)},expression:"form.contactPhone"}})],1)],1):e._e(),"offline"!==e.form.teachMode?t("el-form-item",{attrs:{label:"联系电话",prop:"contactPhone"}},[t("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"联系电话（必填）"},model:{value:e.form.contactPhone,callback:function(t){e.$set(e.form,"contactPhone",t)},expression:"form.contactPhone"}})],1):e._e(),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.submitting},on:{click:e.onSubmit}},[e._v("发布")]),t("el-button",{on:{click:e.onReset}},[e._v("重置")])],1)],1)],1)],1)},o=[],s=r(6879),l=r(4381),n=r(9550),i=r(5042),c={name:"BigClassPublish",data(){return{form:{teacherId:null,subjectId:null,subjectName:"",subjectPath:[],title:"",totalLessons:2,startDate:"",startTime:"",durationMinutes:120,repeatType:"daily",teachMode:"offline",coverUrl:"",tags:[],intro:"",address:"",province:"",city:"",district:"",detailAddress:"",contactPhone:""},rules:{teacherId:[{required:!0,message:"请选择教师",trigger:"change"}],title:[{required:!0,message:"请输入课程名称",trigger:"blur"}],totalLessons:[{required:!0,message:"请输入课时",trigger:"change"}],startDate:[{required:!0,message:"请选择开始日期",trigger:"change"}],startTime:[{required:!0,message:"请选择上课时间",trigger:"change"}],contactPhone:[{required:!0,message:"请输入联系电话",trigger:"blur"}]},teacherOptions:[],subjectTree:[],submitting:!1}},mounted(){this.loadTeachers(),this.loadSubjects()},methods:{async loadTeachers(){try{const e=await(0,l.$A)({pageNum:1,pageSize:200}),t=e&&e.data&&e.data.list?e.data.list:[];this.teacherOptions=t}catch(e){}},async loadSubjects(){try{const e=await n.MF.tree(),t=e=>(e||[]).map(e=>({id:e.id,categoryName:e.categoryName||e.name,children:t(e.children)}));this.subjectTree=t(e&&e.data||[])}catch(e){}},onTeacherDropdown(){this.teacherOptions.length||this.loadTeachers()},onSubjectChange(e){if(Array.isArray(e)&&e.length){e.length>2&&(this.form.subjectPath=e.slice(0,2)),this.form.subjectId=this.form.subjectPath[this.form.subjectPath.length-1];const t=(e,r)=>{for(let a=0;a<e.length;a++){const o=e[a];if(o.id===r)return o.categoryName;const s=o.children&&t(o.children,r);if(s)return s}return""};this.form.subjectName=t(this.subjectTree,this.form.subjectId)}else this.form.subjectId=null,this.form.subjectName=""},normalizeUrl(e){if(!e)return"";const t="/api";return/^https?:\/\//i.test(e)?e:t.replace(/\/$/,"")+"/"+e.replace(/^\//,"")},async uploadCover(e){try{const t=new FormData;t.append("file",e.file);const r=await(0,s.A)({url:"/mini/upload/file",method:"post",data:t,headers:{"Content-Type":"multipart/form-data"}});r&&200===r.code&&r.data?(this.form.coverUrl=r.data.url,this.$message.success("上传成功"),e.onSuccess(r,e.file)):e.onError(new Error(r?.message||"上传失败"))}catch(t){e.onError(t)}},onReset(){this.$refs.form&&this.$refs.form.resetFields(),this.form.tags=[],this.form.coverUrl=""},async onSubmit(){this.$refs.form.validate(async e=>{if(e){this.submitting=!0;try{const e={...this.form};if(Array.isArray(e.tags)&&(e.tags=JSON.stringify(e.tags)),e.startTime){const t=String(e.startTime);e.startTime=5===t.length?t+":00":t}const t=await(0,i.y)(e);t&&(200===t.code||t.success)?(this.$message.success("发布成功"),this.onReset()):this.$message.error(t&&t.message?t.message:"发布失败")}catch(t){this.$message.error(t&&t.message?t.message:"发布失败")}finally{this.submitting=!1}}})}}},u=c,m=r(1656),d=(0,m.A)(u,a,o,!1,null,"def54770",null),f=d.exports},9550:function(e,t,r){r.d(t,{E8:function(){return c},MF:function(){return m},S9:function(){return o},Wd:function(){return i},_Y:function(){return l},jX:function(){return s},kY:function(){return u},s_:function(){return n}});var a=r(6879);function o(){return(0,a.A)({url:"/system/teacher-level/list",method:"get"})}function s(e){return(0,a.A)({url:"/system/teacher-level",method:"post",data:e})}function l(e,t){return(0,a.A)({url:`/system/teacher-level/${e}`,method:"put",data:t})}function n(e){return(0,a.A)({url:`/system/teacher-level/${e}`,method:"delete"})}const i={list(){return(0,a.A)({url:"/system/learning-system/list",method:"get"})},create(e){return(0,a.A)({url:"/system/learning-system",method:"post",data:e})},update(e,t){return(0,a.A)({url:`/system/learning-system/${e}`,method:"put",data:t})},remove(e){return(0,a.A)({url:`/system/learning-system/${e}`,method:"delete"})}},c={current(){return(0,a.A)({url:"/system/lesson-price/current",method:"get"})},save(e){return(0,a.A)({url:"/system/lesson-price/save",method:"post",data:e})}},u={list(e){return(0,a.A)({url:"/system/course-banner/list",method:"get",params:e})},create(e){return(0,a.A)({url:"/system/course-banner",method:"post",data:e})},update(e,t){return(0,a.A)({url:`/system/course-banner/${e}`,method:"put",data:t})},remove(e){return(0,a.A)({url:`/system/course-banner/${e}`,method:"delete"})}},m={list(e){return(0,a.A)({url:"/course-category/list",method:"get",params:e})},tree(){return(0,a.A)({url:"/course-category/tree",method:"get"})},topLevel(){return(0,a.A)({url:"/course-category/top-level",method:"get"})},detail(e){return(0,a.A)({url:`/course-category/${e}`,method:"get"})},create(e){return(0,a.A)({url:"/course-category",method:"post",data:e})},update(e,t){return(0,a.A)({url:`/course-category/${e}`,method:"put",data:t})},updateStatus(e,t){return(0,a.A)({url:`/course-category/${e}/status`,method:"post",params:{status:t}})},updateSort(e,t){return(0,a.A)({url:`/course-category/${e}/sort`,method:"post",params:{sortOrder:t}})},move(e,t){return(0,a.A)({url:`/course-category/${e}/move`,method:"post",params:{newParentId:t}})},delete(e){return(0,a.A)({url:`/course-category/${e}`,method:"delete"})},batchDelete(e){return(0,a.A)({url:"/course-category/batch",method:"delete",data:e})},checkCode(e,t){return(0,a.A)({url:"/course-category/check-code",method:"get",params:{categoryCode:e,excludeId:t}})},checkName(e,t,r){return(0,a.A)({url:"/course-category/check-name",method:"get",params:{categoryName:e,parentId:t,excludeId:r}})}}}}]);