"use strict";(self["webpackChunkadmin_frontend"]=self["webpackChunkadmin_frontend"]||[]).push([[763],{1763:function(e,t,a){a.r(t),a.d(t,{default:function(){return u}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-container"},[t("div",{staticClass:"content-box"},[t("h2",[e._v("课程反馈")]),t("div",{staticClass:"search-bar"},[t("el-form",{staticClass:"search-form",attrs:{inline:!0,model:e.searchForm}},[t("el-form-item",{attrs:{label:"学生姓名"}},[t("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:"请输入学生姓名",clearable:""},model:{value:e.searchForm.studentName,callback:function(t){e.$set(e.searchForm,"studentName",t)},expression:"searchForm.studentName"}})],1),t("el-form-item",{attrs:{label:"教师姓名"}},[t("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:"请输入教师姓名",clearable:""},model:{value:e.searchForm.teacherName,callback:function(t){e.$set(e.searchForm,"teacherName",t)},expression:"searchForm.teacherName"}})],1),t("el-form-item",{attrs:{label:"评分"}},[t("el-select",{attrs:{placeholder:"请选择评分",clearable:""},model:{value:e.searchForm.starRating,callback:function(t){e.$set(e.searchForm,"starRating",t)},expression:"searchForm.starRating"}},[t("el-option",{attrs:{label:"5星",value:5}}),t("el-option",{attrs:{label:"4星",value:4}}),t("el-option",{attrs:{label:"3星",value:3}}),t("el-option",{attrs:{label:"2星",value:2}}),t("el-option",{attrs:{label:"1星",value:1}})],1)],1),t("el-form-item",{attrs:{label:"审核状态"}},[t("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.searchForm.auditStatus,callback:function(t){e.$set(e.searchForm,"auditStatus",t)},expression:"searchForm.auditStatus"}},[t("el-option",{attrs:{label:"待审核",value:0}}),t("el-option",{attrs:{label:"审核通过",value:1}}),t("el-option",{attrs:{label:"审核拒绝",value:2}})],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),t("el-button",{on:{click:e.resetSearch}},[e._v("重置")])],1)],1)],1),t("el-tabs",{staticStyle:{"margin-bottom":"12px"},on:{"tab-click":e.onRoleChanged},model:{value:e.activeRole,callback:function(t){e.activeRole=t},expression:"activeRole"}},[t("el-tab-pane",{attrs:{label:"教师反馈",name:"teacher"}}),t("el-tab-pane",{attrs:{label:"学生评价",name:"student"}})],1),t("div",{staticClass:"table-container"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"feedbackTable",staticClass:"custom-table",staticStyle:{width:"100%"},attrs:{data:e.feedbackList,stripe:""},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),t("el-table-column",{attrs:{label:"学生信息",width:"160",fixed:"left"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"user-info"},[t("el-avatar",{attrs:{size:40}},[e._v(" "+e._s(a.row.studentName?a.row.studentName.charAt(0):"")+" ")]),t("div",{staticClass:"user-details"},[t("div",{staticClass:"user-name"},[e._v(e._s(a.row.studentName))]),t("div",{staticClass:"user-no"},[e._v(e._s(a.row.studentNo))])])],1)]}}])}),t("el-table-column",{attrs:{label:"教师信息",width:"160"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"user-info"},[t("el-avatar",{attrs:{size:40}},[e._v(" "+e._s(a.row.teacherName?a.row.teacherName.charAt(0):"")+" ")]),t("div",{staticClass:"user-details"},[t("div",{staticClass:"user-name"},[e._v(e._s(a.row.teacherName))]),t("div",{staticClass:"user-level"},[e._v(e._s(e.getTeacherLevelText(a.row.teacherLevel)))])])],1)]}}])}),t("el-table-column",{attrs:{prop:"courseName",label:"课程名称",width:"200","show-overflow-tooltip":""}}),"student"===e.activeRole?t("el-table-column",{attrs:{label:"评分",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("el-rate",{attrs:{value:e.row.starRating||0,disabled:"","show-score":"","text-color":"#ff9900","score-template":"{value}"}})]}}],null,!1,282087623)}):e._e(),t("el-table-column",{attrs:{label:"反馈内容",width:"300","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"review-content"},[t("p",[e._v(e._s(a.row.reviewContent||"暂无文字评价"))]),a.row.reviewTags&&a.row.reviewTags.length?t("div",{staticClass:"review-tags"},e._l(a.row.reviewTags,function(a){return t("el-tag",{key:a,staticStyle:{margin:"2px"},attrs:{size:"mini"}},[e._v(" "+e._s(a)+" ")])}),1):e._e()])]}}])}),t("el-table-column",{attrs:{label:"反馈时间",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDate(t.row.createTime))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"150",fixed:"right",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleViewDetail(a.row)}}},[e._v("查看")]),0===a.row.auditStatus?t("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.handleQuickAudit(a.row,1)}}},[e._v(" 通过 ")]):e._e(),0===a.row.auditStatus?t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleQuickAudit(a.row,2)}}},[e._v(" 拒绝 ")]):e._e()]}}])})],1),t("div",{staticClass:"pagination-container"},[t("span",{staticClass:"pagination-info"},[e._v(" 显示 "+e._s((e.currentPage-1)*e.pageSize+1)+" - "+e._s(Math.min(e.currentPage*e.pageSize,e.total))+" 条，共 "+e._s(e.total)+" 条 ")]),t("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)],1),t("el-dialog",{attrs:{title:"课程反馈详情",visible:e.detailDialogVisible,width:"600px"},on:{"update:visible":function(t){e.detailDialogVisible=t}}},[e.currentFeedback?t("div",{staticClass:"feedback-detail"},[t("el-descriptions",{attrs:{column:2,border:""}},[t("el-descriptions-item",{attrs:{label:"学生姓名"}},[e._v(e._s(e.currentFeedback.studentName))]),t("el-descriptions-item",{attrs:{label:"教师姓名"}},[e._v(e._s(e.currentFeedback.teacherName))]),t("el-descriptions-item",{attrs:{label:"课程名称"}},[e._v(e._s(e.currentFeedback.courseName))]),t("el-descriptions-item",{attrs:{label:"评分"}},[t("el-rate",{attrs:{value:e.currentFeedback.starRating||0,disabled:"","show-score":"","text-color":"#ff9900"}})],1)],1),t("div",{staticClass:"feedback-content"},[t("h4",[e._v("反馈内容")]),t("p",[e._v(e._s(e.currentFeedback.reviewContent||"暂无文字评价"))]),e.currentFeedback.reviewTags&&e.currentFeedback.reviewTags.length?t("div",[t("h4",[e._v("评价标签")]),e._l(e.currentFeedback.reviewTags,function(a){return t("el-tag",{key:a,staticStyle:{margin:"4px"}},[e._v(" "+e._s(a)+" ")])})],2):e._e()])],1):e._e(),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.detailDialogVisible=!1}}},[e._v("关闭")]),e.currentFeedback&&0===e.currentFeedback.auditStatus?t("el-button",{attrs:{type:"success"},on:{click:function(t){return e.handleQuickAudit(e.currentFeedback,1)}}},[e._v(" 通过审核 ")]):e._e(),e.currentFeedback&&0===e.currentFeedback.auditStatus?t("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.handleQuickAudit(e.currentFeedback,2)}}},[e._v(" 拒绝审核 ")]):e._e()],1)])],1)},r=[],l=a(6879),i={name:"CourseFeedback",data(){return{loading:!1,activeRole:"teacher",filterType:"all",searchForm:{studentName:"",teacherName:"",starRating:null,auditStatus:null},feedbackList:[],selectedFeedbacks:[],currentPage:1,pageSize:10,total:0,totalReviews:156,pendingReviews:23,excellentReviews:108,averageRating:4.3,detailDialogVisible:!1,currentFeedback:null}},computed:{hasSelection(){return this.selectedFeedbacks.length>0}},mounted(){this.fetchList()},methods:{async fetchList(){this.loading=!0;try{const e={pageNum:this.currentPage,pageSize:this.pageSize,roleType:this.activeRole,studentName:this.searchForm.studentName||void 0,teacherName:this.searchForm.teacherName||void 0,starRating:this.searchForm.starRating||void 0},t=await(0,l.A)({url:"/spark/feedback/list",method:"get",params:e}),a=t.data||t;this.feedbackList=a.list||[],this.total=a.total||0}catch(e){this.$message.error("加载失败")}finally{this.loading=!1}},onRoleChanged(){this.currentPage=1,this.fetchList()},generateMockFeedbacks(){const e=[],t=["陈舍","孙小通","Bella","Duoduo","Camellia"],a=["张明教授","李华老师","王老师","刘英语"],s=["IGCSE数学基础","A-Level物理","IGCSE化学","雅思口语"],r=["老师讲课非常清楚，耐心回答问题，孩子的成绩提升很快！","课程很有趣，实验讲解很详细，孩子受益匪浅。","老师很专业，但有时候讲得有点快。","课程安排很合理，知识点讲解到位。"];for(let l=0;l<20;l++)e.push({id:l+1,studentName:t[Math.floor(Math.random()*t.length)],studentNo:"S"+(1e3+l),teacherName:a[Math.floor(Math.random()*a.length)],teacherLevel:["expert","senior","intermediate"][Math.floor(3*Math.random())],courseName:s[Math.floor(Math.random()*s.length)],starRating:Math.floor(5*Math.random())+1,reviewContent:r[Math.floor(Math.random()*r.length)],reviewTags:["讲课清楚","耐心","成绩提升"],auditStatus:Math.floor(3*Math.random()),createTime:new Date(Date.now()-30*Math.random()*24*60*60*1e3)});return e},handleSearch(){this.currentPage=1,this.fetchList()},resetSearch(){this.searchForm={studentName:"",teacherName:"",starRating:null,auditStatus:null},this.handleSearch()},switchFilter(e){this.filterType=e,this.currentPage=1,this.handleSearch()},handleSelectionChange(e){this.selectedFeedbacks=e},handleSizeChange(e){this.pageSize=e,this.handleSearch()},handleCurrentChange(e){this.currentPage=e,this.handleSearch()},async handleBatchAudit(e){const t=(this.selectedFeedbacks||[]).map(e=>e.id);if(t.length)try{await(0,l.A)({url:"/student/review/batch-audit",method:"post",data:{ids:t,status:e}});const a=1===e?"通过":"拒绝";this.$message.success(`批量审核${a}成功`),this.fetchStatistics(),this.fetchList()}catch(a){this.$message.error("操作失败")}},handleViewDetail(e){this.currentFeedback=e,this.detailDialogVisible=!0},async handleQuickAudit(e,t){try{await(0,l.A)({url:`/student/review/${e.id}/audit`,method:"put",params:{status:t}});const a=1===t?"通过":"拒绝";this.$message.success(`审核${a}成功`),this.detailDialogVisible&&(this.detailDialogVisible=!1),this.fetchStatistics(),this.fetchList()}catch(a){this.$message.error("操作失败")}},getTeacherLevelText(e){const t={junior:"初级",intermediate:"中级",senior:"高级",expert:"专家"};return t[e]||"初级"},getAuditStatusTagType(e){const t={0:"warning",1:"success",2:"danger"};return t[e]||""},getAuditStatusText(e){const t={0:"待审核",1:"已通过",2:"已拒绝"};return t[e]||"未知"},formatDate(e){return e?new Date(e).toLocaleDateString():"-"}}},n=i,c=a(1656),o=(0,c.A)(n,s,r,!1,null,"283c36a3",null),u=o.exports}}]);