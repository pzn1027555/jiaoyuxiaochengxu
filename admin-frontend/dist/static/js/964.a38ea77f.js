"use strict";(self["webpackChunkadmin_frontend"]=self["webpackChunkadmin_frontend"]||[]).push([[964],{314:function(t,e,o){o.d(e,{E8:function(){return l},F4:function(){return s},FJ:function(){return i},Uh:function(){return u},aC:function(){return r},o8:function(){return c},q4:function(){return n},vz:function(){return d}});var a=o(6879);function s(t){return(0,a.A)({url:"/community/posts/list",method:"post",data:t})}function r(t){return(0,a.A)({url:`/community/posts/${t}`,method:"get"})}function n(t,e){return(0,a.A)({url:`/community/posts/${t}/take-down`,method:"put",params:{reason:e}})}function i(t){return(0,a.A)({url:"/community/resources/list",method:"post",data:t})}function l(t,e){return(0,a.A)({url:`/community/resources/${t}`,method:"get",params:e?{source:e}:void 0})}function u(t){return(0,a.A)({url:"/community/resources/update",method:"put",data:t})}function c(t,e){return(0,a.A)({url:`/community/resources/${t}`,method:"delete",params:e?{source:e}:void 0})}function d(t,e,o){return(0,a.A)({url:`/community/resources/${t}/download`,method:"get",params:o?{source:o,userId:e}:{userId:e}})}},3964:function(t,e,o){o.r(e),o.d(e,{default:function(){return c}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"page-container"},[e("div",{staticClass:"content-box"},[e("h2",[t._v("帖子管理")]),e("el-form",{staticClass:"search-form",attrs:{model:t.queryForm,inline:!0}},[e("el-form-item",{attrs:{label:"关键词"}},[e("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"搜索标题和内容",clearable:""},model:{value:t.queryForm.keyword,callback:function(e){t.$set(t.queryForm,"keyword",e)},expression:"queryForm.keyword"}})],1),e("el-form-item",{attrs:{label:"发布者"}},[e("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"请输入发布者姓名",clearable:""},model:{value:t.queryForm.authorName,callback:function(e){t.$set(t.queryForm,"authorName",e)},expression:"queryForm.authorName"}})],1),e("el-form-item",{attrs:{label:"帖子状态"}},[e("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择状态",clearable:""},model:{value:t.queryForm.postStatus,callback:function(e){t.$set(t.queryForm,"postStatus",e)},expression:"queryForm.postStatus"}},[e("el-option",{attrs:{label:"草稿",value:0}}),e("el-option",{attrs:{label:"已发布",value:2}}),e("el-option",{attrs:{label:"已下架",value:3}}),e("el-option",{attrs:{label:"已删除",value:4}})],1)],1),e("el-form-item",[e("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleSearch}},[t._v("搜索")]),e("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:t.handleReset}},[t._v("重置")])],1)],1),e("div",{staticClass:"toolbar"},[e("div",{staticClass:"toolbar-left"},[e("el-button",{attrs:{type:"success",disabled:0===t.selectedPosts.length,icon:"el-icon-upload"},on:{click:t.batchPublish}},[t._v(" 批量发布 ")]),e("el-button",{attrs:{type:"danger",disabled:0===t.selectedPosts.length,icon:"el-icon-download"},on:{click:t.batchTakeDown}},[t._v(" 批量下架 ")])],1),e("div",{staticClass:"toolbar-right"},[e("el-button",{attrs:{type:"text",icon:"el-icon-refresh"},on:{click:t.handleRefresh}},[t._v("刷新")])],1)]),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.postList,stripe:"",border:""},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection",width:"55"}}),e("el-table-column",{attrs:{prop:"title",label:"标题",width:"200"},scopedSlots:t._u([{key:"default",fn:function(o){return[e("el-link",{attrs:{type:"primary"},on:{click:function(e){return t.viewPostDetail(o.row)}}},[t._v(t._s(o.row.title))])]}}])}),e("el-table-column",{attrs:{prop:"authorName",label:"发布者",width:"100"},scopedSlots:t._u([{key:"default",fn:function(o){return[e("div",[t._v(t._s(o.row.authorName))]),e("el-tag",{attrs:{size:"mini",type:t.getAuthorTypeColor(o.row.authorType)}},[t._v(" "+t._s(t.getAuthorTypeText(o.row.authorType))+" ")])]}}])}),e("el-table-column",{attrs:{prop:"categoryName",label:"分类",width:"100"}}),e("el-table-column",{attrs:{label:"内容预览","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.getContentSummary(e.row.content))+" ")]}}])}),e("el-table-column",{attrs:{label:"状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(o){return[e("div",[e("el-tag",{attrs:{type:t.getPostStatusType(o.row.postStatus)}},[t._v(" "+t._s(t.getPostStatusText(o.row.postStatus))+" ")])],1)]}}])}),e("el-table-column",{attrs:{label:"统计数据",width:"120"},scopedSlots:t._u([{key:"default",fn:function(o){return[e("div",[t._v("浏览: "+t._s(o.row.viewCount||0))]),e("div",[t._v("点赞: "+t._s(o.row.likeCount||0))]),e("div",[t._v("评论: "+t._s(o.row.commentCount||0))])]}}])}),e("el-table-column",{attrs:{prop:"createTime",label:"创建时间",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.formatDateTime(e.row.createTime))+" ")]}}])}),e("el-table-column",{attrs:{label:"操作",width:"200",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(o){return[2===o.row.postStatus?e("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.takeDownPost(o.row)}}},[t._v(" 下架 ")]):t._e(),e("el-dropdown",{attrs:{trigger:"click"},on:{command:t.handleCommand}},[e("el-button",{attrs:{type:"text",size:"mini"}},[t._v(" 更多"),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:{action:"view",row:o.row}}},[t._v("查看详情")]),e("el-dropdown-item",{staticStyle:{color:"#F56C6C"},attrs:{command:{action:"delete",row:o.row}}},[t._v("删除帖子")])],1)],1)]}}])})],1),e("div",{staticClass:"pagination-wrapper"},[e("el-pagination",{attrs:{"current-page":t.queryForm.pageNum,"page-sizes":[10,20,50,100],"page-size":t.queryForm.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1),e("el-dialog",{attrs:{title:"帖子详情",visible:t.detailDialogVisible,width:"800px"},on:{"update:visible":function(e){t.detailDialogVisible=e}}},[t.postDetail?e("div",[e("h3",[t._v(t._s(t.postDetail.title))]),e("p",[e("strong",[t._v("发布者:")]),t._v(" "+t._s(t.postDetail.authorName)+" ("+t._s(t.getAuthorTypeText(t.postDetail.authorType))+")")]),e("p",[e("strong",[t._v("分类:")]),t._v(" "+t._s(t.postDetail.categoryName))]),e("p",[e("strong",[t._v("状态:")]),t._v(" "+t._s(t.getPostStatusText(t.postDetail.postStatus)))]),3===t.postDetail.postStatus&&t.postDetail.takeDownReason?e("p",[e("strong",[t._v("下架原因:")]),t._v(" "+t._s(t.postDetail.takeDownReason))]):t._e(),e("p",[e("strong",[t._v("创建时间:")]),t._v(" "+t._s(t.formatDateTime(t.postDetail.createTime)))]),e("div",{staticStyle:{"margin-top":"20px"}},[e("strong",[t._v("内容:")]),e("div",{staticStyle:{"margin-top":"10px",padding:"10px",border:"1px solid #ddd","border-radius":"4px"},domProps:{innerHTML:t._s(t.postDetail.content)}})])]):t._e()])],1)},s=[],r=o(314),n={name:"PostManagement",data(){return{loading:!1,postList:[],total:0,selectedPosts:[],queryForm:{keyword:"",authorName:"",postStatus:null,auditStatus:null,pageNum:1,pageSize:20},detailDialogVisible:!1,postDetail:null}},created(){this.loadPostList()},methods:{async loadPostList(){this.loading=!0;try{const t=await(0,r.F4)(this.queryForm);200===t.code&&(this.postList=t.data.list,this.total=t.data.total)}catch(t){this.$message.error("加载帖子列表失败")}finally{this.loading=!1}},handleSearch(){this.queryForm.pageNum=1,this.loadPostList()},handleReset(){this.queryForm={keyword:"",authorName:"",postStatus:null,auditStatus:null,pageNum:1,pageSize:20},this.loadPostList()},handleRefresh(){this.loadPostList()},handleSizeChange(t){this.queryForm.pageSize=t,this.queryForm.pageNum=1,this.loadPostList()},handleCurrentChange(t){this.queryForm.pageNum=t,this.loadPostList()},handleSelectionChange(t){this.selectedPosts=t},async viewPostDetail(t){try{const e=await(0,r.aC)(t.id);200===e.code&&(this.postDetail=e.data,this.detailDialogVisible=!0)}catch(e){this.$message.error("获取帖子详情失败")}},async batchPublish(){this.$message.info("批量发布功能开发中")},async batchTakeDown(){this.$message.info("批量下架功能开发中")},async takeDownPost(t){try{const{value:e}=await this.$prompt("请输入下架原因","下架帖子",{confirmButtonText:"确定",cancelButtonText:"取消",inputValidator:t=>t&&t.trim().length>0,inputErrorMessage:"请输入下架原因"}),o=await(0,r.q4)(t.id,e);200===o.code&&(this.$message.success("下架成功"),this.loadPostList())}catch(e){"cancel"!==e&&this.$message.error("下架失败")}},handleCommand(t){const{action:e,row:o}=t;switch(e){case"view":this.viewPostDetail(o);break;case"delete":this.deletePost(o);break}},formatDateTime(t){return t?new Date(t).toLocaleString():"-"},getContentSummary(t){return t?t.length>50?t.substring(0,50)+"...":t:""},getPostStatusText(t){const e={0:"草稿",1:"待审核",2:"已发布",3:"已下架",4:"已删除"};return e[t]||"未知状态"},getPostStatusType(t){const e={0:"info",1:"warning",2:"success",3:"danger",4:"info"};return e[t]||""},getAuthorTypeText(t){const e={student:"学生",teacher:"教师",parent:"家长",admin:"管理员"};return e[t]||"学生"},getAuthorTypeColor(t){const e={student:"",teacher:"success",parent:"warning",admin:"warning"};return e[t]||""}}},i=n,l=o(1656),u=(0,l.A)(i,a,s,!1,null,"53e44bd9",null),c=u.exports}}]);