"use strict";(self["webpackChunkadmin_frontend"]=self["webpackChunkadmin_frontend"]||[]).push([[689],{4689:function(t,e,a){a.r(e),a.d(e,{default:function(){return d}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"complaint-manage"},[e("div",{staticClass:"filter-container"},[e("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.query}},[e("el-form-item",{attrs:{label:"投诉状态"}},[e("el-select",{staticStyle:{width:"160px"},attrs:{clearable:"",placeholder:"全部"},model:{value:t.query.complaintStatus,callback:function(e){t.$set(t.query,"complaintStatus",e)},expression:"query.complaintStatus"}},[e("el-option",{attrs:{label:"待处理",value:"0"}}),e("el-option",{attrs:{label:"处理中",value:"1"}}),e("el-option",{attrs:{label:"已解决",value:"2"}}),e("el-option",{attrs:{label:"已关闭",value:"3"}})],1)],1),e("el-form-item",{attrs:{label:"投诉类型"}},[e("el-select",{staticStyle:{width:"160px"},attrs:{clearable:"",placeholder:"全部"},model:{value:t.query.complaintType,callback:function(e){t.$set(t.query,"complaintType",e)},expression:"query.complaintType"}},[e("el-option",{attrs:{label:"服务态度",value:"service"}}),e("el-option",{attrs:{label:"教学质量",value:"quality"}}),e("el-option",{attrs:{label:"时间安排",value:"time"}}),e("el-option",{attrs:{label:"其他",value:"other"}})],1)],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.getList}},[e("i",{staticClass:"el-icon-search"}),t._v(" 查询")]),e("el-button",{on:{click:t.reset}},[e("i",{staticClass:"el-icon-refresh"}),t._v(" 重置")])],1)],1)],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.list,border:""}},[e("el-table-column",{attrs:{prop:"complaintNo",label:"投诉编号",width:"160"}}),e("el-table-column",{attrs:{prop:"complainantName",label:"投诉人",width:"120"}}),e("el-table-column",{attrs:{prop:"complainedName",label:"被投诉人",width:"120"}}),e("el-table-column",{attrs:{prop:"complaintType",label:"投诉类型",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.complaintTypeText(e.row.complaintType))+" ")]}}])}),e("el-table-column",{attrs:{prop:"complaintTitle",label:"投诉标题",width:"200","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"complaintContent",label:"投诉内容",width:"240","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"complaintStatus",label:"状态",width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{attrs:{type:t.statusTagType(a.row.complaintStatus),size:"small"}},[t._v(t._s(t.statusText(a.row.complaintStatus)))])]}}])}),e("el-table-column",{attrs:{prop:"createTime",label:"投诉时间",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.formatDate(e.row.createTime)))]}}])}),e("el-table-column",{attrs:{label:"操作",width:"220",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{size:"mini",type:"primary",disabled:2===a.row.complaintStatus||3===a.row.complaintStatus},on:{click:function(e){return t.handleComplaint(a.row)}}},[t._v("处理")]),e("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(e){return t.viewDetail(a.row)}}},[t._v("详情")])]}}])})],1),e("div",{staticClass:"pagination-container"},[e("el-pagination",{attrs:{"current-page":t.query.page,"page-sizes":[10,20,30,50],"page-size":t.query.size,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":e=>{t.query.size=e,t.query.page=1,t.getList()},"current-change":e=>{t.query.page=e,t.getList()}}})],1),e("el-dialog",{attrs:{title:"投诉处理",visible:t.dialogVisible,width:"60%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-form",{attrs:{model:t.complaintForm,"label-width":"120px"}},[e("el-form-item",{attrs:{label:"投诉编号"}},[e("el-input",{attrs:{readonly:""},model:{value:t.complaintForm.complaintNo,callback:function(e){t.$set(t.complaintForm,"complaintNo",e)},expression:"complaintForm.complaintNo"}})],1),e("el-form-item",{attrs:{label:"投诉人"}},[e("el-input",{attrs:{readonly:""},model:{value:t.complaintForm.complainantName,callback:function(e){t.$set(t.complaintForm,"complainantName",e)},expression:"complaintForm.complainantName"}})],1),e("el-form-item",{attrs:{label:"被投诉人"}},[e("el-input",{attrs:{readonly:""},model:{value:t.complaintForm.complainedName,callback:function(e){t.$set(t.complaintForm,"complainedName",e)},expression:"complaintForm.complainedName"}})],1),e("el-form-item",{attrs:{label:"投诉类型"}},[e("el-input",{attrs:{readonly:""},model:{value:t.complaintForm.complaintTypeText,callback:function(e){t.$set(t.complaintForm,"complaintTypeText",e)},expression:"complaintForm.complaintTypeText"}})],1),e("el-form-item",{attrs:{label:"投诉标题"}},[e("el-input",{attrs:{readonly:""},model:{value:t.complaintForm.complaintTitle,callback:function(e){t.$set(t.complaintForm,"complaintTitle",e)},expression:"complaintForm.complaintTitle"}})],1),e("el-form-item",{attrs:{label:"投诉内容"}},[e("el-input",{attrs:{type:"textarea",readonly:"",rows:4},model:{value:t.complaintForm.complaintContent,callback:function(e){t.$set(t.complaintForm,"complaintContent",e)},expression:"complaintForm.complaintContent"}})],1),e("el-form-item",{attrs:{label:"处理结果"}},[e("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入处理结果"},model:{value:t.complaintForm.processResult,callback:function(e){t.$set(t.complaintForm,"processResult",e)},expression:"complaintForm.processResult"}})],1),e("el-form-item",{attrs:{label:"满意度评分"}},[e("el-rate",{attrs:{"show-score":""},model:{value:t.complaintForm.satisfactionScore,callback:function(e){t.$set(t.complaintForm,"satisfactionScore",e)},expression:"complaintForm.satisfactionScore"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.submitProcess}},[t._v("提交处理")])],1)],1)],1)},l=[],i=a(6879);function n(t){return(0,i.A)({url:"/operation/complaints",method:"get",params:t})}function s(t){return(0,i.A)({url:`/operation/complaints/${t}`,method:"get"})}function r(t,e){return(0,i.A)({url:`/operation/complaints/${t}/process`,method:"post",data:e})}var c={name:"Complaint",data(){return{loading:!1,list:[],total:0,query:{page:1,size:10,complaintStatus:"",complaintType:""},dialogVisible:!1,complaintForm:{id:"",complaintNo:"",complainantName:"",complainedName:"",complaintTypeText:"",complaintTitle:"",complaintContent:"",processResult:"",satisfactionScore:0}}},created(){this.getList()},methods:{async getList(){this.loading=!0;try{const t=await n(this.query);if(t&&200===t.code){const e=t.data||{};this.list=e.items||e.list||[],this.total=e.total||0}}catch(t){console.error("获取投诉列表失败",t)}finally{this.loading=!1}},async handleComplaint(t){this.complaintForm={id:t.id,complaintNo:t.complaintNo,complainantName:t.complainantName,complainedName:t.complainedName,complaintTypeText:this.complaintTypeText(t.complaintType),complaintTitle:t.complaintTitle,complaintContent:t.complaintContent,processResult:"",satisfactionScore:0},this.dialogVisible=!0},async submitProcess(){try{await r(this.complaintForm.id,{processResult:this.complaintForm.processResult,satisfactionScore:this.complaintForm.satisfactionScore}),this.$message.success("投诉处理成功"),this.dialogVisible=!1,this.getList()}catch(t){console.error("提交处理失败",t),this.$message.error("提交处理失败")}},async resolveComplaint(t){try{await this.$confirm("确认解决此投诉吗？","提示");const e=await(0,i.A)({url:`/operation/complaints/${t.id}/resolve`,method:"post"});e&&200===e.code&&(this.$message.success("投诉已解决"),this.getList())}catch(e){console.error("解决投诉失败",e)}},async viewDetail(t){try{const e=await s(t.id);if(e&&200===e.code){const t=e.data;this.$alert(`\n            <div style="text-align: left;">\n              <p><strong>投诉编号：</strong>${t.complaintNo}</p>\n              <p><strong>投诉人：</strong>${t.complainantName}</p>\n              <p><strong>被投诉人：</strong>${t.complainedName}</p>\n              <p><strong>投诉类型：</strong>${this.complaintTypeText(t.complaintType)}</p>\n              <p><strong>投诉标题：</strong>${t.complaintTitle}</p>\n              <p><strong>投诉内容：</strong>${t.complaintContent}</p>\n              <p><strong>处理结果：</strong>${t.processResult||"暂无"}</p>\n              <p><strong>满意度评分：</strong>${t.satisfactionScore||"未评分"}</p>\n            </div>\n          `,"投诉详情",{confirmButtonText:"确定",dangerouslyUseHTMLString:!0})}}catch(e){console.error("获取投诉详情失败",e),this.$message.error("获取投诉详情失败")}},complaintTypeText(t){const e={service:"服务态度",quality:"教学质量",time:"时间安排",other:"其他"};return e[t]||t},statusTagType(t){const e={0:"warning",1:"info",2:"success",3:"danger"};return e[t]||"info"},statusText(t){const e={0:"待处理",1:"处理中",2:"已解决",3:"已关闭"};return e[t]||t},formatDate(t){return t?new Date(t.toString().replace("T"," ").replace(/-/g,"/")).toLocaleString("zh-CN"):"-"},reset(){this.query={page:1,size:10,complaintStatus:"",complaintType:""},this.getList()}}},p=c,m=a(1656),u=(0,m.A)(p,o,l,!1,null,"12825ebe",null),d=u.exports}}]);