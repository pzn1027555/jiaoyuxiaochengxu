"use strict";(self["webpackChunkadmin_frontend"]=self["webpackChunkadmin_frontend"]||[]).push([[108],{4381:function(e,t,a){a.d(t,{$A:function(){return o},N2:function(){return u},Pf:function(){return i},RO:function(){return c},Sp:function(){return n},ZF:function(){return l},cg:function(){return s},mH:function(){return d},nJ:function(){return h},qg:function(){return m}});var r=a(6879);function o(e){return(0,r.A)({url:"/teacher/list",method:"get",params:e})}function l(){return(0,r.A)({url:"/teacher/risk-teachers",method:"get"})}function s(e){return(0,r.A)({url:"/mooc/applications",method:"get",params:e})}function i(){return(0,r.A)({url:"/mooc/groups",method:"get"})}function n(e,t){return(0,r.A)({url:`/teacher/${e}`,method:"put",data:t})}function c(e){return(0,r.A)({url:`/teacher/${e}/send-contract`,method:"post"})}function d(e){return(0,r.A)({url:`/teacher/${e}/check`,method:"post"})}function u(e){return(0,r.A)({url:`/teacher/${e}/toggle-hidden`,method:"post"})}function h(e){return(0,r.A)({url:`/teacher/${e}/toggle-recommend`,method:"post"})}function m(e){return(0,r.A)({url:`/teacher/${e}`,method:"delete"})}},5108:function(e,t,a){a.r(t),a.d(t,{default:function(){return u}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-container"},[t("div",{staticClass:"content-box"},[t("h2",[e._v("教师管理")]),t("div",{staticClass:"search-bar"},[t("el-form",{staticClass:"search-form",attrs:{inline:!0,model:e.searchForm}},[t("el-form-item",{attrs:{label:"教师姓名"}},[t("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入教师姓名",clearable:""},model:{value:e.searchForm.teacherName,callback:function(t){e.$set(e.searchForm,"teacherName",t)},expression:"searchForm.teacherName"}})],1),t("el-form-item",{attrs:{label:"教师等级"}},[t("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.searchForm.teacherLevel,callback:function(t){e.$set(e.searchForm,"teacherLevel",t)},expression:"searchForm.teacherLevel"}},[t("el-option",{attrs:{label:"初级",value:"junior"}}),t("el-option",{attrs:{label:"中级",value:"intermediate"}}),t("el-option",{attrs:{label:"高级",value:"senior"}}),t("el-option",{attrs:{label:"专家",value:"expert"}})],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),t("el-button",{on:{click:e.resetSearch}},[e._v("重置")])],1)],1)],1),t("div",{staticClass:"toolbar"},[t("div",{staticClass:"toolbar-left"}),t("div",{staticClass:"toolbar-right"},[t("el-button-group",[t("el-button",{attrs:{type:"all"===e.viewMode?"primary":"default"},on:{click:function(t){return e.switchViewMode("all")}}},[e._v(" 全部教师 ")]),t("el-button",{staticClass:"risk-btn",attrs:{type:"risk"===e.viewMode?"primary":"default"},on:{click:function(t){return e.switchViewMode("risk")}}},[e._v(" 风险教师 "),e.riskCount>0?t("div",{staticClass:"corner-badge"},[e._v(e._s(e.riskCount))]):e._e()])],1)],1)]),t("div",{staticClass:"table-container"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"teacherTable",staticClass:"custom-table",staticStyle:{width:"100%"},attrs:{data:e.teacherList,stripe:""}},[t("el-table-column",{attrs:{label:"教师信息",width:"220",fixed:"left"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"teacher-info"},[t("el-avatar",{attrs:{size:40,src:a.row.avatar}},[e._v(" "+e._s(a.row.teacherName?a.row.teacherName.charAt(0):"")+" ")]),t("div",{staticClass:"teacher-details"},[t("div",{staticClass:"teacher-name"},[e._v(e._s(a.row.teacherName))]),t("div",{staticClass:"teacher-phone"},[e._v(e._s(a.row.phone))])])],1)]}}])}),t("el-table-column",{attrs:{label:"学历",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.certEducation||t.row.education||"-")+" ")]}}])}),t("el-table-column",{attrs:{label:"院校",width:"160",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.certGraduateSchool||t.row.graduationSchool||"-")+" ")]}}])}),t("el-table-column",{attrs:{label:"教授科目",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return e._l(e.getSubjectNames(a.row),function(a){return t("el-tag",{key:a,staticStyle:{margin:"2px"},attrs:{size:"mini"}},[e._v(" "+e._s(a)+" ")])})}}])}),t("el-table-column",{attrs:{label:"等级",width:"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:e.getLevelTagType(a.row.teacherLevel),size:"small"}},[e._v(" "+e._s(e.getTeacherLevelText(a.row.teacherLevel))+" ")])]}}])}),t("el-table-column",{attrs:{prop:"hourlyRate",label:"课时费",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" ¥"+e._s(t.row.hourlyRate)+" ")]}}])}),t("el-table-column",{attrs:{label:"星级评分",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("el-rate",{attrs:{value:e.row.starRating||0,disabled:"","show-score":"","text-color":"#ff9900","score-template":"{value}"}})]}}])}),t("el-table-column",{attrs:{label:"合同状态",width:"110",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:e.getContractStatusTagType(a.row.contractStatus),size:"small"}},[e._v(" "+e._s(e.getContractStatusText(a.row.contractStatus))+" ")])]}}])}),t("el-table-column",{attrs:{label:"投诉率",width:"90",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{class:e.getComplaintRateClass(a.row.complaintRate)},[e._v(" "+e._s(a.row.complaintRate||0)+"% ")])]}}])}),t("el-table-column",{attrs:{prop:"checkCount",label:"抽查次数",width:"90",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.checkCount||0)+" ")]}}])}),t("el-table-column",{attrs:{label:"状态",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[1===a.row.isHidden?t("el-tag",{attrs:{type:"danger",size:"mini"}},[e._v("雪藏")]):e._e(),1===a.row.isRecommended?t("el-tag",{attrs:{type:"success",size:"mini"}},[e._v("推荐")]):e._e(),0===a.row.isHidden&&0===a.row.isRecommended?t("span",[e._v("正常")]):e._e()]}}])}),t("el-table-column",{attrs:{label:"操作",width:"320",fixed:"right",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"action-buttons"},[e._l(e.getAvailableActions(a.row).slice(0,2),function(r,o){return t("el-button",{key:r.command,staticStyle:{"margin-right":"6px"},attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.handleDropdownCommand(r.command,a.row)}}},[e._v(" "+e._s(r.label)+" ")])}),e.getAvailableActions(a.row).length>2?t("el-dropdown",{attrs:{trigger:"click"},on:{command:t=>e.handleDropdownCommand(t,a.row)}},[t("el-button",{attrs:{size:"mini",type:"default"}},[e._v(" 更多"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.getAvailableActions(a.row).slice(2),function(a){return t("el-dropdown-item",{key:a.command,style:"delete"===a.command?"color:#f56c6c":"",attrs:{command:a.command}},[e._v(" "+e._s(a.label)+" ")])}),1)],1):e._e()],2)]}}])})],1),t("div",{staticClass:"pagination-container"},[t("span",{staticClass:"pagination-info"},[e._v(" 显示 "+e._s((e.currentPage-1)*e.pageSize+1)+" - "+e._s(Math.min(e.currentPage*e.pageSize,e.total))+" 条，共 "+e._s(e.total)+" 条 ")]),t("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)]),t("el-dialog",{attrs:{title:"磨课安排",visible:e.moocDialogVisible,width:"520px"},on:{"update:visible":function(t){e.moocDialogVisible=t}}},[t("el-form",{attrs:{model:e.arrangeForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"派遣老师"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择老师",filterable:""},model:{value:e.arrangeForm.selectedTeacherIds,callback:function(t){e.$set(e.arrangeForm,"selectedTeacherIds",t)},expression:"arrangeForm.selectedTeacherIds"}},e._l(e.teacherOptions,function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),t("el-form-item",{attrs:{label:"安排时间"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择日期时间"},model:{value:e.arrangeForm.scheduleTime,callback:function(t){e.$set(e.arrangeForm,"scheduleTime",t)},expression:"arrangeForm.scheduleTime"}})],1),t("el-form-item",{attrs:{label:"群二维码"}},[t("el-upload",{attrs:{"http-request":e.uploadQrcode,"show-file-list":!1,accept:"image/*"}},[t("el-button",{attrs:{size:"mini",type:"primary"}},[e._v("上传二维码")])],1),e.arrangeForm.qrcodeUrl?t("div",{staticStyle:{"margin-top":"8px"}},[t("el-image",{staticStyle:{width:"120px",height:"120px"},attrs:{src:e.normalizeUploadUrl(e.arrangeForm.qrcodeUrl),fit:"contain"}})],1):e._e()],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.moocDialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitMoocAudit}},[e._v("确定")])],1)],1),t("el-dialog",{attrs:{title:"调整教师评级",visible:e.gradeDialogVisible,width:"420px"},on:{"update:visible":function(t){e.gradeDialogVisible=t}}},[t("el-form",{attrs:{model:e.gradeForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"教师等级"}},[t("el-select",{attrs:{placeholder:"请选择等级"},model:{value:e.gradeForm.teacherLevel,callback:function(t){e.$set(e.gradeForm,"teacherLevel",t)},expression:"gradeForm.teacherLevel"}},[t("el-option",{attrs:{label:"初级",value:"junior"}}),t("el-option",{attrs:{label:"中级",value:"intermediate"}}),t("el-option",{attrs:{label:"高级",value:"senior"}}),t("el-option",{attrs:{label:"专家",value:"expert"}})],1)],1),t("el-form-item",{attrs:{label:"说明"}},[t("el-input",{attrs:{type:"textarea",rows:3,placeholder:"调整说明（选填）"},model:{value:e.gradeForm.reason,callback:function(t){e.$set(e.gradeForm,"reason",t)},expression:"gradeForm.reason"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.gradeDialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitGrade}},[e._v("确定")])],1)],1),t("el-dialog",{attrs:{title:"编辑教师",visible:e.editDialogVisible,width:"520px"},on:{"update:visible":function(t){e.editDialogVisible=t}}},[t("el-form",{attrs:{model:e.editForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"姓名"}},[t("el-input",{attrs:{placeholder:"请输入姓名"},model:{value:e.editForm.teacherName,callback:function(t){e.$set(e.editForm,"teacherName",t)},expression:"editForm.teacherName"}})],1),t("el-form-item",{attrs:{label:"手机号"}},[t("el-input",{attrs:{placeholder:"请输入手机号"},model:{value:e.editForm.phone,callback:function(t){e.$set(e.editForm,"phone",t)},expression:"editForm.phone"}})],1),t("el-form-item",{attrs:{label:"教师等级"}},[t("el-select",{attrs:{placeholder:"请选择等级"},model:{value:e.editForm.teacherLevel,callback:function(t){e.$set(e.editForm,"teacherLevel",t)},expression:"editForm.teacherLevel"}},[t("el-option",{attrs:{label:"初级",value:"junior"}}),t("el-option",{attrs:{label:"中级",value:"intermediate"}}),t("el-option",{attrs:{label:"高级",value:"senior"}}),t("el-option",{attrs:{label:"专家",value:"expert"}})],1)],1),t("el-form-item",{attrs:{label:"课时费(¥)"}},[t("el-input",{attrs:{type:"number",min:"0",placeholder:"请输入课时费"},model:{value:e.editForm.hourlyRate,callback:function(t){e.$set(e.editForm,"hourlyRate",e._n(t))},expression:"editForm.hourlyRate"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.editDialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitEdit}},[e._v("保存")])],1)],1)],1)},o=[],l=a(4381),s=a(6879),i={name:"TeacherList",data(){return{loading:!1,viewMode:"all",searchForm:{teacherName:"",teacherLevel:""},teacherList:[],currentPage:1,pageSize:10,total:0,riskCount:0,auditDialogVisible:!1,auditForm:{teacherId:null,auditStatus:1,teacherLevel:"junior",commissionRate:15,auditReason:""},moocDialogVisible:!1,moocForm:{applicationId:null,teacherId:null,groupId:null,status:1,auditReason:""},arrangeForm:{applicationId:null,selectedTeacherIds:[],scheduleTime:"",qrcodeUrl:"",groupName:""},teacherOptions:[],moocGroups:[],gradeDialogVisible:!1,gradeForm:{teacherId:null,teacherLevel:"junior",reason:""},editDialogVisible:!1,editForm:{id:null,teacherName:"",phone:"",teacherLevel:"junior",hourlyRate:null}}},computed:{},mounted(){this.loadTeacherList(),this.loadStatistics()},methods:{getSubjectNames(e){return e?e.subjectsMap&&"object"===typeof e.subjectsMap?Object.values(e.subjectsMap):Array.isArray(e.subjectsNameList)?e.subjectsNameList:Array.isArray(e.subjects)?e.subjects:[]:[]},normalizeUploadUrl(e){if(!e)return"";if(/^https?:\/\//.test(e))return e;const t=e.startsWith("/")?e:`/${e}`,a="/api";return t.startsWith("/uploads/"),`${a}${t}`},getAvailableActions(e){const t=[];return t.push({command:"edit",label:"编辑"}),e.hasMoocApply&&t.push({command:"mooc",label:"磨课安排"}),t.push({command:"grade",label:"调整教师评级"}),0===e.contractStatus&&t.push({command:"sendContract",label:"发送合同"}),(e.checkCount||0)<3&&t.push({command:"check",label:"抽查"}),t.push({command:1===e.isHidden?"unHide":"hide",label:1===e.isHidden?"解除雪藏":"雪藏"}),t.push({command:1===e.isRecommended?"unRecommend":"recommend",label:1===e.isRecommended?"取消推荐":"设为推荐"}),t.push({command:"delete",label:"删除"}),t},async uploadQrcode({file:e,onSuccess:t,onError:a}){try{const r=new FormData;r.append("file",e);const o=await(0,s.A)({url:"/mini/upload/file",method:"post",data:r});if(200===o.code){const e=o.data&&(o.data.url||o.data.coverUrl)||"";this.arrangeForm.qrcodeUrl=e,t&&t(o)}else a&&a(new Error(o.message||"上传失败"))}catch(r){a&&a(r)}},async openMoocDialog(e){this.moocForm={applicationId:null,teacherId:e.id,groupId:null,status:1,auditReason:""},this.arrangeForm={applicationId:null,selectedTeacherIds:[],scheduleTime:"",qrcodeUrl:"",groupName:`${e.teacherName}磨课`};try{const[t,a]=await Promise.all([(0,l.cg)({teacherId:e.id,status:0}),(0,l.Pf)()]);200===t.code&&(t.data||[]).length&&(this.moocForm.applicationId=t.data[0].id,this.arrangeForm.applicationId=t.data[0].id),200===a.code&&(this.moocGroups=a.data||[]),this.teacherOptions=(this.teacherList||[]).map(e=>({label:e.teacherName,value:e.id}))}catch(t){}this.moocDialogVisible=!0},async submitMoocAudit(){if(this.moocForm.applicationId)if(this.arrangeForm.selectedTeacherIds.length)if(this.arrangeForm.scheduleTime)if(this.arrangeForm.qrcodeUrl)try{const e={applicationId:this.arrangeForm.applicationId,groupName:this.arrangeForm.groupName,dispatchTeachers:JSON.stringify(this.arrangeForm.selectedTeacherIds),scheduleTime:this.arrangeForm.scheduleTime,qrcodeUrl:this.arrangeForm.qrcodeUrl,creatorUserId:0},t=await(0,s.A)({url:"/mooc/arrange",method:"post",data:e});200===t.code&&(this.$message.success("已安排磨课并通过申请"),this.moocDialogVisible=!1,this.loadTeacherList())}catch(e){this.$message.error("安排失败")}else this.$message.error("请上传群二维码");else this.$message.error("请选择安排时间");else this.$message.error("请选择派遣老师");else this.$message.error("未找到待审核的磨课申请")},async loadTeacherList(){this.loading=!0;try{const e={...this.searchForm,pageNum:this.currentPage,pageSize:this.pageSize};"risk"===this.viewMode&&(e.risk=1);const t=await(0,l.$A)(e);200===t.code&&(this.teacherList=t.data.list||[],this.total=t.data.total||0)}catch(e){this.$message.error("加载教师列表失败"),console.error(e)}finally{this.loading=!1}},async loadStatistics(){try{const e=await(0,l.ZF)();200===e.code&&(this.riskCount=e.data.length)}catch(e){console.error("加载统计数据失败",e)}},handleSearch(){this.currentPage=1,this.loadTeacherList()},resetSearch(){this.searchForm={teacherName:"",teacherLevel:""},this.handleSearch()},switchViewMode(e){this.viewMode=e,this.currentPage=1,this.loadTeacherList()},handleSizeChange(e){this.pageSize=e,this.loadTeacherList()},handleCurrentChange(e){this.currentPage=e,this.loadTeacherList()},handleDropdownCommand(e,t){switch(e){case"edit":this.openEditDialog(t);break;case"mooc":this.openMoocDialog(t);break;case"sendContract":this.handleSendContract(t);break;case"grade":this.openGradeDialog(t);break;case"check":this.handleCheck(t);break;case"hide":case"unHide":this.handleToggleHidden(t);break;case"recommend":case"unRecommend":this.handleToggleRecommend(t);break;case"delete":this.handleDelete(t);break}},openGradeDialog(e){this.gradeForm={teacherId:e.id,teacherLevel:e.teacherLevel||"junior",reason:""},this.gradeDialogVisible=!0},openEditDialog(e){this.editForm={id:e.id,teacherName:e.teacherName||"",phone:e.phone||"",teacherLevel:e.teacherLevel||"junior",hourlyRate:e.hourlyRate||null},this.editDialogVisible=!0},async submitEdit(){try{const{id:e,teacherName:t,phone:a,teacherLevel:r,hourlyRate:o}=this.editForm;await(0,l.Sp)(e,{teacherName:t,phone:a,teacherLevel:r,hourlyRate:o}),this.$message.success("保存成功"),this.editDialogVisible=!1,this.loadTeacherList()}catch(e){this.$message.error("保存失败")}},async submitGrade(){try{const e=this.gradeForm.teacherLevel;await(0,s.A)({url:`/teacher/${this.gradeForm.teacherId}`,method:"put",data:{teacherLevel:e}}),this.$message.success("调整成功"),this.gradeDialogVisible=!1,this.loadTeacherList()}catch(e){this.$message.error("调整失败")}},async handleSendContract(e){try{const t=await(0,l.RO)(e.id);200===t.code&&(this.$message.success("合同发送成功"),this.loadTeacherList())}catch(t){this.$message.error("合同发送失败"),console.error(t)}},async handleToggleHidden(e){try{const t=await(0,l.N2)(e.id);200===t.code&&(this.$message.success("操作成功"),this.loadTeacherList())}catch(t){this.$message.error("操作失败"),console.error(t)}},async handleToggleRecommend(e){try{const t=await(0,l.nJ)(e.id);200===t.code&&(this.$message.success("操作成功"),this.loadTeacherList())}catch(t){this.$message.error("操作失败"),console.error(t)}},async handleCheck(e){try{await this.$confirm("确认对该教师进行一次抽查？","提示",{type:"warning"});const t=await(0,l.mH)(e.id);200===t.code&&(this.$message.success("抽查次数增加成功"),this.loadTeacherList())}catch(t){"cancel"!==t&&(this.$message.error("操作失败"),console.error(t))}},handleDelete(e){this.$confirm(`确定删除教师"${e.teacherName}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const t=await(0,l.qg)(e.id);200===t.code&&(this.$message.success("删除成功"),this.loadTeacherList())}catch(t){this.$message.error("删除失败"),console.error(t)}})},getLevelTagType(e){const t={junior:"",intermediate:"success",senior:"warning",expert:"danger"};return t[e]||""},getTeacherLevelText(e){const t={junior:"初级",intermediate:"中级",senior:"高级",expert:"专家"};return t[e]||"初级"},getContractStatusTagType(e){const t={0:"info",1:"warning",2:"success",3:"danger"};return t[e]||""},getContractStatusText(e){const t={0:"未发送",1:"已发送待签",2:"已签署",3:"已过期"};return t[e]||"未知"},getComplaintRateClass(e){return e>=5?"complaint-rate-high":e>=2?"complaint-rate-medium":"complaint-rate-low"}}},n=i,c=a(1656),d=(0,c.A)(n,r,o,!1,null,"6fe7a88a",null),u=d.exports}}]);