<view class="page-container">
  <custom-header title="学习计划" show-back="{{true}}" bind:headerReady="onHeaderReady" />

  <view class="content" style="padding-top: 0px;">
    <block wx:if="{{loading}}">
      <view class="loading">加载中...</view>
    </block>

    <block wx:else>
      <!-- 日历部分（参照教师日历样式） -->
      <view class="calendar-section">
        <view class="calendar-header">
          <text class="ms-btn" bindtap="prevMonth">‹</text>
          <text class="ms-title">{{year}}年{{month}}月</text>
          <text class="ms-btn" bindtap="nextMonth">›</text>
        </view>
        <view class="ms-week">
          <text wx:for="{{['一','二','三','四','五','六','日']}}" wx:key="*this" class="ms-wd">{{item}}</text>
        </view>
        <view class="ms-grid">
          <view class="ms-cell" wx:for="{{days}}" wx:key="index" data-index="{{index}}" bindtap="onSelectDay">
            <text class="ms-date {{item.isToday ? 'today' : ''}} {{item.selected ? 'selected' : ''}}">{{item.date}}</text>
            <view class="ms-dot {{item.hasCourse ? 'on' : ''}}"></view>
          </view>
        </view>
      </view>

      <!-- 日期 + 排课信息列表 -->
      <view class="schedule-list">
        <view class="schedule-title"><text class="bar"></text>{{selectedDate}}</view>
        <block wx:if="{{items && items.length}}">
          <view class="schedule-items">
            <view class="schedule-item" wx:for="{{items}}" wx:key="id">
              <view style="width: 8rpx; background:#54B247; height: 100%; margin-right: 20rpx; border-radius: 4rpx;"></view>
              <view class="schedule-info">
                <view class="schedule-title-text" style="color:#0F0F14;">{{item.startTimeText}} ~ {{item.endTimeText}}</view>
                <view class="detail-row">
                  <text style="color:#43434D; font-size:28rpx;">{{item.title}}</text>
                  <text style="color:#0F0F14; font-size:28rpx;">第{{item.lessonNo}}课 <text style="color:#9898A6;">/ 共{{item.totalLessons}}节课</text></text>
                </view>
                <view style="color:#9898A6; font-size:24rpx;">{{item.desc}}</view>
              </view>
            </view>
          </view>
        </block>
        <view class="no-schedule" wx:else>当天暂无课程</view>
      </view>
    </block>
  </view>

  <view class="footer-action" wx:if="{{viewMode !== 'teacher'}}">
    <button class="confirm-btn {{submitting ? 'loading' : ''}}" loading="{{submitting}}" bindtap="onConfirmPlan">同意计划并购买</button>
  </view>
</view>

