<!-- 学生个人信息编辑页面 -->
<view class="edit-profile-container">
  <view class="content-container" >

    <!-- 个人信息表单 -->
    <view class="profile-form">

      <!-- 头像 -->
      <view class="form-item avatar-item" bindtap="selectAvatar">
        <text class="form-label">头像</text>
        <view class="form-value-container">
          <view class="avatar-container">
            <image class="avatar-image" src="{{userProfile.avatar || '/images/workspace/default-avatar.png'}}" mode="aspectFill"></image>
            <image class="arrow-icon" src="/images/workspace/next.png" mode="aspectFit"></image>
          </view>
        </view>
      </view>

      <!-- 姓名 -->
      <view class="form-item" bindtap="editDetailName">
        <text class="form-label">姓名</text>
        <view class="form-value-container">
          <text class="form-value">{{userProfile.name || '请输入姓名'}}</text>
          <image class="arrow-icon" src="/images/workspace/next.png" mode="aspectFit"></image>
        </view>
      </view>

      <!-- 性别 -->
      <view class="form-item" bindtap="selectGender">
        <text class="form-label">性别</text>
        <view class="form-value-container">
          <text class="form-value">{{userProfile.gender || '请选择性别'}}</text>
          <image class="arrow-icon" src="/images/workspace/next.png" mode="aspectFit"></image>
        </view>
      </view>

      <!-- 出生日期 -->
      <view class="form-item">
        <text class="form-label">出生日期</text>
        <picker mode="date" value="{{userProfile.birthDate}}" start="1990-01-01" end="2035-12-31" bindchange="onBirthChange">
          <view class="form-value-container">
            <text class="form-value">{{userProfile.birthDate || '请选择出生日期'}}</text>
            <image class="arrow-icon" src="/images/workspace/next.png" mode="aspectFit"></image>
          </view>
        </picker>
      </view>

      <!-- 年级 -->
      <view class="form-item">
        <text class="form-label">年级</text>
        <picker mode="selector" range="{{gradeOptions}}" bindchange="onGradePickerChange">
          <view class="form-value-container">
            <text class="form-value">{{userProfile.grade || '请选择年级'}}</text>
            <image class="arrow-icon" src="/images/workspace/next.png" mode="aspectFit"></image>
          </view>
        </picker>
      </view>

      <!-- 所在省市区 -->
      <view class="form-item">
        <text class="form-label">所在省市区</text>
        <picker mode="multiSelector" range="{{regionPickerRange}}" value="{{regionPickerValue}}" bindchange="onRegionChange" bindcolumnchange="onRegionColumnChange" bindcancel="onRegionCancel">
          <view class="form-value-container">
            <text class="form-value">{{regionText || '请选择所在地区'}}</text>
            <image class="arrow-icon" src="/images/workspace/next.png" mode="aspectFit"></image>
          </view>
        </picker>
      </view>

      <!-- 详细地址 -->
      <view class="form-item" bindtap="editDetailAddress">
        <text class="form-label">详细地址</text>
        <view class="form-value-container">
          <text class="form-value">{{userProfile.detailAddress || '请输入详细地址'}}</text>
          <image class="arrow-icon" src="/images/workspace/next.png" mode="aspectFit"></image>
        </view>
      </view>

      <!-- 手机号码 -->
      <view class="form-item">
        <text class="form-label">手机号码</text>
        <input class="form-input" value="{{userProfile.phone}}" placeholder="请输入手机号码" type="number" bindinput="onPhoneInput" />
      </view>

      <!-- 意向学科（替换所授科目） -->
      <view class="form-item tags-item">
        <text class="form-label">意向学科</text>
        <view class="tags-container">
          <view class="tag-item" wx:for="{{displaySubjects}}" wx:key="id">
            <text class="tag-text">{{item.name}}</text>
            <image class="tag-close" src="/images/workspace/delete.png" mode="aspectFit" bindtap="removeSubject" data-id="{{item.id}}" data-index="{{index}}"></image>
          </view>
          <view class="add-tag-btn" bindtap="openSubjectPicker">
            <image class="add-icon" src="/images/workspace/add.png" mode="aspectFit"></image>
          </view>
        </view>
      </view>

      

    </view>

    <!-- 开启学习之路按钮 -->
    <view class="save-btn-container">
      <button class="save-btn" bindtap="saveProfile">开启学习之路</button>
    </view>

  </view>

  <!-- 姓名/地址弹窗复用教师版结构 -->
  <view class="modal-overlay {{showAddressModal ? 'show' : ''}}" bindtap="hideAddressModal">
    <view class="address-modal" catchtap="preventClose">
      <view class="modal-header">
        <text class="modal-title">详细地址</text>
        <text class="modal-close" bindtap="hideAddressModal">×</text>
      </view>
      <view class="modal-content">
        <textarea class="address-textarea" value="{{tempDetailAddress}}" placeholder="请输入详细地址" bindinput="onDetailAddressInput" maxlength="200" auto-height></textarea>
      </view>
      <view class="modal-actions">
        <button class="modal-btn cancel-btn" bindtap="hideAddressModal">取消</button>
        <button class="modal-btn confirm-btn" bindtap="confirmDetailAddress">确定</button>
      </view>
    </view>
  </view>

  <view class="modal-overlay {{showNameModal ? 'show' : ''}}" bindtap="hideAddressModal">
    <view class="address-modal" catchtap="preventClose">
      <view class="modal-header">
        <text class="modal-title">姓名</text>
        <text class="modal-close" bindtap="hideNameModal">×</text>
      </view>
      <view class="modal-content">
        <textarea class="address-textarea" value="{{tempDetailName}}" placeholder="请输入姓名" bindinput="onDetailNameInput" maxlength="50" auto-height></textarea>
      </view>
      <view class="modal-actions">
        <button class="modal-btn cancel-btn" bindtap="hideNameModal">取消</button>
        <button class="modal-btn confirm-btn" bindtap="confirmDetailName">确定</button>
      </view>
    </view>
  </view>

</view>

<subject-picker
  show="{{showSubjectPicker}}"
  value="{{selectedSubjectsForPicker}}"
  multiple="{{true}}"
  title="选择意向学科"
  bind:confirm="onSubjectPickerConfirm"
  bind:cancel="closeSubjectPicker"
/>

