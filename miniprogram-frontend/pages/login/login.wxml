<!--pages/login/login.wxml-->
<view class="login-container">
  <!-- 背景装饰 -->
  <view class="bg-decoration">
    <image class="bg-image" src="/images/login/bg.png" mode="aspectFill"></image>
    <view class="bg-overlay"></view>
  </view>

  <!-- 顶部Logo和标题 -->
  <view class="header">
    <view class="logo-container">
      <image class="logo" src="/images/login/logo.png" mode="aspectFit"></image>
    </view>
  </view>

  <!-- 登录表单 -->
  <view class="login-form">
    <view class="form-title">登录</view>
    <view class="form-subtitle">未注册过的手机号会自动创建新账号</view>

    <!-- 手机号输入 -->
    <view class="input-group">
      <view class="input-container {{phone ? 'has-value' : ''}}">
        <view class="floating-label">手机号</view>
        <image class="input-icon" src="/images/login/userNameIcon.png"></image>
        <input 
          class="input-field" 
          type="number" 
          value="{{phone}}"
          bindinput="onPhoneInput"
          bindfocus="onPhoneFocus"
          bindblur="onPhoneBlur"
          maxlength="11"
        />
        <button 
          class="code-btn {{canSendCode ? '' : 'disabled'}}" 
          bindtap="sendCode"
          disabled="{{!canSendCode}}"
        >
          {{codeButtonText}}
        </button>
      </view>
    </view>

    <!-- 验证码输入 -->
    <view class="input-group">
      <view class="input-container {{code ? 'has-value' : ''}}">
        <view class="floating-label">验证码</view>
        <image class="input-icon" src="/images/login/codeIcon.png"></image>
        <input 
          class="input-field" 
          type="number" 
          value="{{code}}"
          bindinput="onCodeInput"
          bindfocus="onCodeFocus"
          bindblur="onCodeBlur"
          maxlength="6"
        />
      </view>
    </view>

    <!-- 登录按钮 -->
    <button 
      class="login-btn {{canLogin ? '' : 'disabled'}}" 
      bindtap="handleLogin"
      disabled="{{!canLogin}}"
      loading="{{loginLoading}}"
    >
      登录
    </button>

    <!-- 协议同意 -->
    <view class="agreement">
      <view class="agreement-item" bindtap="toggleAgreement">
        <view class="custom-checkbox">
          <image wx:if="{{agreed}}" class="checkbox-icon" src="/images/login/selected.png"></image>
          <view wx:else class="checkbox-unchecked"></view>
        </view>
        <text class="agreement-text">我已阅读并同意<text class="link" catchtap="showAgreement" data-type="service">《服务协议》</text>和<text class="link" catchtap="showAgreement" data-type="privacy">《隐私协议》</text>
        </text>
      </view>
    </view>
  </view>

  <!-- 其他登录方式 -->
  <view class="other-login" wx:if="{{showWxLogin}}">
    <view class="divider">
      <view class="divider-line"></view>
      <text class="divider-text">或</text>
      <view class="divider-line"></view>
    </view>
  </view>
</view>

<!-- 协议弹窗 -->
<view class="modal-overlay {{showModal ? 'show' : ''}}" bindtap="hideModal">
  <view class="modal-content" catchtap="preventClose">
    <view class="modal-header">
      <text class="modal-title">{{modalTitle}}</text>
      <text class="modal-close" bindtap="hideModal">×</text>
    </view>
    <scroll-view class="modal-body" scroll-y>
      <text class="modal-text">{{modalContent}}</text>
    </scroll-view>
  </view>
</view>