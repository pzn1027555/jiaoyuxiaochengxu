<!-- 教师个人信息编辑页面 -->
<view class="edit-profile-container">
  <!-- 通用顶部导航栏 -->
  <custom-header 
    title="个人信息" 
    bind:headerReady="onHeaderReady"
    bind:back="onBackTap"
  >
    <view slot="right" class="header-right-content">
      <view class="menu-icon" bindtap="showMenu">
        <!-- 🔧 切图位置1：三点菜单图标 建议尺寸：48rpx × 48rpx -->
        <view class="menu-dots">
          <view class="dot"></view>
          <view class="dot"></view>
          <view class="dot"></view>
        </view>
      </view>
      <view class="record-icon" bindtap="showRecordOptions">
        <!-- 🔧 切图位置2：录制/其他功能图标 建议尺寸：64rpx × 64rpx -->
        <view class="record-placeholder"></view>
      </view>
    </view>
  </custom-header>

  <!-- 页面内容区域 -->
  <view class="content-container" style="padding-top: {{headerHeight}}px;">

    <!-- 个人信息表单 -->
    <view class="profile-form">
      
      <!-- 头像 -->
      <view class="form-item avatar-item basic-info" bindtap="selectAvatar">
        <text class="form-label">头像</text>
        <view class="avatar-container">
          <image class="avatar-image" src="{{userProfile.avatar || '/images/workspace/default-avatar.png'}}" mode="aspectFill"></image>
          <image class="arrow-icon" src="/images/workspace/next.png" mode="aspectFit"></image>
        </view>
      </view>

      <!-- 姓名 -->
      <view class="form-item basic-info" bindtap="editDetailName">
        <text class="form-label">姓名</text>
        <view class="form-value-container">
          <text class="form-value">{{userProfile.name || '请输入姓名'}}</text>
          <image class="arrow-icon" src="/images/workspace/next.png" mode="aspectFit"></image>
        </view>
      </view>

      <!-- 性别 -->
      <view class="form-item basic-info" bindtap="selectGender">
        <text class="form-label">性别</text>
        <view class="form-value-container">
          <text class="form-value">{{userProfile.gender || '请选择性别'}}</text>
          <image class="arrow-icon" src="/images/workspace/next.png" mode="aspectFit"></image>
        </view>
      </view>

      <!-- 所在省市区（单行展示 + 多列选择器） -->
      <view class="form-item basic-info">
        <text class="form-label">所在省市区</text>
        <picker mode="multiSelector"
                range="{{regionPickerRange}}"
                value="{{regionPickerValue}}"
                bindchange="onRegionChange"
                bindcolumnchange="onRegionColumnChange"
                bindcancel="onRegionCancel">
          <view class="form-value-container">
            <text class="form-value">{{regionText || '请选择所在地区'}}</text>
            <image class="arrow-icon" src="/images/workspace/next.png" mode="aspectFit"></image>
          </view>
        </picker>
      </view>

      <!-- 详细地址 -->
      <view class="form-item basic-info" bindtap="editDetailAddress">
        <text class="form-label">详细地址</text>
        <view class="form-value-container">
          <text class="form-value">{{userProfile.detailAddress || '请输入详细地址'}}</text>
          <image class="arrow-icon" src="/images/workspace/next.png" mode="aspectFit"></image>
        </view>
      </view>

      <!-- 手机号码 -->
      <view class="form-item basic-info">
        <text class="form-label">手机号码</text>
        <input 
          class="form-input" 
          value="{{userProfile.phone}}" 
          placeholder="请输入手机号码"
          type="number"
          bindinput="onPhoneInput"
        />
      </view>

      <!-- 所授科目 -->
      <view class="form-item tags-item">
        <text class="form-label">所授科目</text>
        <view class="tags-container">
          <view 
            class="tag-item" 
            wx:for="{{displaySubjects}}" 
            wx:key="id"
          >
            <text class="tag-text">{{item.name}}</text>
            <image class="tag-close" src="/images/workspace/delete.png" mode="aspectFit" bindtap="removeSubject" data-id="{{item.id}}" data-index="{{index}}"></image>
          </view>
          <view class="add-tag-btn" bindtap="openSubjectPicker">
            <image class="add-icon" src="/images/workspace/add.png" mode="aspectFit"></image>
          </view>
        </view>
      </view>

      <!-- 老师标签 -->
      <view class="form-item tags-item">
        <text class="form-label">老师标签</text>
        <view class="tags-container">
          <view 
            class="tag-item" 
            wx:for="{{userProfile.teacherTags}}" 
            wx:key="index"
          >
            <text class="tag-text">{{item}}</text>
            <image class="tag-close" src="/images/workspace/delete.png" mode="aspectFit" bindtap="removeTeacherTag" data-index="{{index}}"></image>
          </view>
          <view class="add-tag-btn" bindtap="addTeacherTag">
            <image class="add-icon" src="/images/workspace/add.png" mode="aspectFit"></image>
          </view>
        </view>
      </view>

      <!-- 老师简介 -->
      <view class="form-item intro-item">
        <text class="form-label">老师简介</text>
        <textarea 
          class="form-textarea"
          value="{{userProfile.introduction}}"
          placeholder="请填写简介"
          bindinput="onIntroductionInput"
          maxlength="500"
          auto-height
        ></textarea>
      </view>

    </view>

    <!-- 保存按钮 -->
    <view class="save-btn-container">
      <button class="save-btn" bindtap="saveProfile">保存信息</button>
    </view>

  </view>
</view>

<subject-picker 
  show="{{showSubjectPicker}}"
  value="{{selectedSubjectsForPicker}}"
  multiple="{{true}}"
  title="选择所授科目"
  bind:confirm="onSubjectPickerConfirm"
  bind:cancel="closeSubjectPicker"
/>



<!-- 详细地址输入弹窗 -->
<view class="modal-overlay {{showAddressModal ? 'show' : ''}}" bindtap="hideAddressModal">
  <view class="address-modal" catchtap="preventClose">
    <view class="modal-header">
      <text class="modal-title">详细地址</text>
      <text class="modal-close" bindtap="hideAddressModal">×</text>
    </view>
    <view class="modal-content">
      <textarea 
        class="address-textarea"
        value="{{tempDetailAddress}}"
        placeholder="请输入详细地址"
        bindinput="onDetailAddressInput"
        maxlength="200"
        auto-height
      ></textarea>
    </view>
    <view class="modal-actions">
      <button class="modal-btn cancel-btn" bindtap="hideAddressModal">取消</button>
      <button class="modal-btn confirm-btn" bindtap="confirmDetailAddress">确定</button>
    </view>
  </view>
</view>

<view class="modal-overlay {{showNameModal ? 'show' : ''}}" bindtap="hideAddressModal">
  <view class="address-modal" catchtap="preventClose">
    <view class="modal-header">
      <text class="modal-title">姓名</text>
      <text class="modal-close" bindtap="hideNameModal">×</text>
    </view>
    <view class="modal-content">
      <textarea 
        class="address-textarea"
        value="{{tempDetailName}}"
        placeholder="请输入教师姓名"
        bindinput="onDetailNameInput"
        maxlength="200"
        auto-height
      ></textarea>
    </view>
    <view class="modal-actions">
      <button class="modal-btn cancel-btn" bindtap="hideNameModal">取消</button>
      <button class="modal-btn confirm-btn" bindtap="confirmDetailName">确定</button>
    </view>
  </view>
</view>

<!-- 标签输入弹窗 -->
<view class="modal-overlay {{showTagInputModal ? 'show' : ''}}" bindtap="hideTagInputModal">
  <view class="address-modal" catchtap="preventClose">
    <view class="modal-header">
      <text class="modal-title">添加标签</text>
      <text class="modal-close" bindtap="hideTagInputModal">×</text>
    </view>
    <view class="modal-content">
      <textarea 
        class="address-textarea"
        value="{{tempTagInput}}"
        placeholder="请输入标签内容"
        bindinput="onTagInput"
        maxlength="200"
        auto-height
      ></textarea>
    </view>
    <view class="modal-actions">
      <button class="modal-btn cancel-btn" bindtap="hideTagInputModal">取消</button>
      <button class="modal-btn confirm-btn" bindtap="confirmAddTag">确定</button>
    </view>
  </view>
</view>

<!-- 移除旧的搜索选择器组件，统一使用内置 picker -->

