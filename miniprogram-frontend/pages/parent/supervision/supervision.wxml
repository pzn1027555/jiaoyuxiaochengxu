<!--pages/parent/supervision/supervision.wxml-->
<view class="container">
  <!-- 孩子选择器 -->
  <view class="child-selector">
    <picker bindchange="onChildChange" range="{{children}}" range-key="name">
      <view class="picker-content">
        <view wx:if="{{selectedChild}}" class="selected-child">
          <image class="child-avatar" src="{{selectedChild.avatar}}" mode="aspectFill" binderror="onAvatarError"></image>
          <view class="child-info">
            <view class="child-name-row">
              <text class="child-name">{{selectedChild.name}}</text>
              <image wx:if="{{selectedChild.gender==='male'}}" class="gender-icon" src="/images/student/male.png" mode="widthFix"></image>
              <image wx:if="{{selectedChild.gender==='female'}}" class="gender-icon" src="/images/student/female.png" mode="widthFix"></image>
            </view>
            <text class="child-detail">{{selectedChild.grade}}</text>
          </view>
        </view>
        <view class="switch-group">
          <text class="switch-text">切换子女</text>
          <image class="picker-next" src="/images/workspace/next.png" mode="widthFix"></image>
        </view>
      </view>
    </picker>
  </view>

  <!-- 学习时长统计卡片（切图占位） -->
  <view class="study-duration-card">
    <image class="card-bg" src="/images/profile/moneyBg.png" mode="scaleToFill"></image>
    <view class="card-title">学习时长（小时）</view>
    <view class="duration-metrics center">
      <view class="metric"><text class="value">{{duration.today}}</text><text class="label">今日</text></view>
      <view class="metric-sep"></view>
      <view class="metric"><text class="value">{{duration.week}}</text><text class="label">本周</text></view>
      <view class="metric-sep"></view>
      <view class="metric"><text class="value">{{duration.month}}</text><text class="label">本月</text></view>
    </view>
  </view>

  <!-- 学习时长趋势图表 -->
  <view class="chart-section">
    <view class="chart-header">
      <text class="chart-title">学习时长趋势</text>
      <view class="segmented">
        <view class="seg-thumb" style="left: {{segLeft}}"></view>
        <view class="seg-item {{chartPeriod==='day'?'active':''}}" data-key="day" bindtap="switchPeriod">日</view>
        <view class="seg-item {{chartPeriod==='week'?'active':''}}" data-key="week" bindtap="switchPeriod">周</view>
        <view class="seg-item {{chartPeriod==='month'?'active':''}}" data-key="month" bindtap="switchPeriod">月</view>
      </view>
    </view>
    <canvas type="2d" id="studyChart" canvas-id="studyChartCanvas" class="chart-canvas"></canvas>
  </view>

  <!-- 报告 tabs 与月份选择 -->
  <view class="report-section">
    <view class="report-header">
      <view class="tabs">
        <view class="tab {{activeTab==='feedback'?'active':''}}" data-key="feedback" bindtap="switchTab">课程反馈</view>
        <view class="tab {{activeTab==='midterm'?'active':''}}" data-key="midterm" bindtap="switchTab">中期报告</view>
      </view>
      <picker mode="date" fields="month" value="{{selectedMonth}}" bindchange="onMonthChange">
        <view class="month-picker">{{selectedMonth}} ▾</view>
      </picker>
    </view>

    <!-- 课程反馈列表 -->
    <view wx:if="{{activeTab==='feedback'}}" class="report-list">
      <block wx:for="{{feedbackList}}" wx:key="id">
        <view class="report-item">
          <image class="avatar" src="{{item.teacherAvatar}}" mode="aspectFill"></image>
          <view class="content">
            <view class="line1"><text class="strong">{{item.teacherName}}</text><text class="normal"> 给您的孩子写了反馈</text></view>
            <view class="line2">{{item.time}}</view>
            <view class="bubble">{{item.content}}</view>
          </view>
        </view>
      </block>
    </view>

    <!-- 中期报告列表 -->
    <view wx:if="{{activeTab==='midterm'}}" class="report-list">
      <block wx:for="{{midtermList}}" wx:key="id">
        <view class="report-item">
          <image class="avatar" src="{{item.teacherAvatar}}" mode="aspectFill"></image>
          <view class="content">
            <view class="line1"><text class="strong">{{item.teacherName}}</text><text class="normal"> 给您的孩子写了 </text><text class="strong">{{item.courseName}}</text><text class="normal"> 的中期报告</text></view>
            <view class="line2">{{item.time}}</view>
            <view class="bubble">{{item.content}}</view>
          </view>
        </view>
      </block>
    </view>
  </view>

</view>
