<!--pages/parent/supervision/supervision.wxml-->
<view class="container">
  <!-- 顶部孩子横向选择（与 study-plan 对齐） -->
  <scroll-view class="children-bar" scroll-x="true" show-scrollbar="false">
    <view class="children-track">
      <view class="child {{currentStudentId===item.studentId?'active':''}}" wx:for="{{students}}" wx:key="studentId" data-id="{{item.studentId}}" bindtap="onPickStudent">
        <image class="avatar" src="{{item.studentAvatar || '/images/default-avatar.png'}}" mode="aspectFill" />
        <text class="name">{{item.studentName}}</text>
      </view>
    </view>
  </scroll-view>

  <!-- 学习时长统计卡片（切图占位） -->
  <view class="study-duration-card" bindtap="goStudyPlan">
    <image class="card-bg" src="/images/profile/moneyBg.png" mode="scaleToFill"></image>
    <view class="card-title">学习时长（小时）</view>
    <view class="duration-metrics center">
      <view class="metric"><text class="value">{{duration.today}}</text><text class="label">今日</text></view>
      <view class="metric-sep"></view>
      <view class="metric"><text class="value">{{duration.week}}</text><text class="label">本周</text></view>
      <view class="metric-sep"></view>
      <view class="metric"><text class="value">{{duration.month}}</text><text class="label">本月</text></view>
    </view>
  </view>

  <!-- 学习时长趋势图表 -->
  <view class="chart-section">
    <view class="chart-header">
      <text class="chart-title">学习时长趋势</text>
      <view class="segmented">
        <view class="seg-thumb" style="left: {{segLeft}}"></view>
        <view class="seg-item {{chartPeriod==='day'?'active':''}}" data-key="day" bindtap="switchPeriod">日</view>
        <view class="seg-item {{chartPeriod==='week'?'active':''}}" data-key="week" bindtap="switchPeriod">周</view>
        <view class="seg-item {{chartPeriod==='month'?'active':''}}" data-key="month" bindtap="switchPeriod">月</view>
      </view>
    </view>
    <view wx:if="{{showChart}}">
      <canvas type="2d" id="studyChart" canvas-id="studyChartCanvas" class="chart-canvas"></canvas>
    </view>
  </view>

  <!-- 报告 tabs 与月份选择 -->
  <view class="report-section">
    <view class="report-header">
      <view class="tabs">
        <view class="tab {{activeTab==='feedback'?'active':''}}" data-key="feedback" bindtap="switchTab">课程反馈</view>
        <view class="tab {{activeTab==='midterm'?'active':''}}" data-key="midterm" bindtap="switchTab">中期报告</view>
      </view>
      <picker mode="date" fields="month" value="{{selectedMonth}}" bindchange="onMonthChange">
        <view class="month-picker">{{selectedMonth}} ▾</view>
      </picker>
    </view>

    <!-- 课程反馈列表 -->
    <view wx:if="{{activeTab==='feedback'}}" class="report-list">
      <block wx:for="{{feedbackList}}" wx:key="id">
        <view class="report-item">
          <image class="avatar" src="{{item.teacherAvatar}}" mode="aspectFill"></image>
          <view class="content">
            <view class="line1"><text class="strong">{{item.teacherName}}</text><text class="normal"> 给您的孩子写了 </text><text class="strong">{{item.courseName}}</text><text class="normal"> 的课程反馈</text></view>
            <view class="line2">{{item.time}}</view>
            <view class="bubble">{{item.content}}</view>
          </view>
        </view>
      </block>
    </view>

    <!-- 中期报告列表 -->
    <view wx:if="{{activeTab==='midterm'}}" class="report-list">
      <block wx:for="{{midtermList}}" wx:key="id">
        <view class="report-item">
          <image class="avatar" src="{{item.teacherAvatar}}" mode="aspectFill"></image>
          <view class="content">
            <view class="line1"><text class="strong">{{item.teacherName}}</text><text class="normal"> 给您的孩子写了 </text><text class="strong">{{item.courseName}}</text><text class="normal"> 的中期报告</text></view>
            <view class="line2">{{item.time}}</view>
            <view class="bubble">{{item.content}}</view>
          </view>
        </view>
      </block>
    </view>
  </view>

</view>
